<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <title>Your Reflection | Mirror of Truth</title>

    <style>
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MIRROR OF TRUTH - REFLECTION OUTPUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

      /* â•­â”€ RESET & FOUNDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
      }

      body {
        background: #020617;
        color: #fff;
        font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        line-height: 1.6;
        overflow-x: hidden;
        min-height: 100vh;
        position: relative;
        touch-action: manipulation;
      }

      /* â•­â”€ COSMIC BACKGROUND SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .cosmic-background {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
      }

      .cosmic-gradient {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at 20% 30%,
            rgba(59, 130, 246, 0.05) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(147, 51, 234, 0.04) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 50% 50%,
            rgba(251, 191, 36, 0.03) 0%,
            transparent 70%
          );
        animation: cosmicShift 80s ease-in-out infinite;
      }

      @keyframes cosmicShift {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
        }
        33% {
          transform: scale(1.05) rotate(120deg);
        }
        66% {
          transform: scale(0.98) rotate(240deg);
        }
      }

      /* â•­â”€ MAIN LAYOUT STRUCTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .main-container {
        position: relative;
        z-index: 10;
        min-height: 100vh;
        max-width: 900px;
        margin: 0 auto;
        padding: clamp(1rem, 3vw, 2rem);
      }

      /* â•­â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .back-link {
        position: fixed;
        top: clamp(1rem, 3vh, 2rem);
        left: clamp(1rem, 3vw, 2rem);
        z-index: 100;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: clamp(0.6rem, 2vh, 0.8rem) clamp(1rem, 3vw, 1.5rem);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.03)
        );
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 50px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-size: clamp(0.75rem, 2vw, 0.9rem);
        font-weight: 400;
        transition: all 0.3s ease;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        white-space: nowrap;
      }

      .back-link:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.12),
          rgba(255, 255, 255, 0.06)
        );
        border-color: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.95);
        transform: translateY(-1px);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
      }

      /* â•­â”€ ARTIFACT CTA BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .artifact-cta {
        margin-top: clamp(5rem, 10vh, 8rem);
        margin-bottom: clamp(2rem, 4vw, 3rem);
        padding: clamp(1.5rem, 3vw, 2rem);
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.08) 0%,
          rgba(245, 158, 11, 0.04) 100%
        );
        backdrop-filter: blur(25px);
        border: 1px solid rgba(251, 191, 36, 0.2);
        border-radius: 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
        animation: artifactGlow 4s ease-in-out infinite;
      }

      .artifact-cta::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          rgba(251, 191, 36, 0.6),
          transparent
        );
      }

      @keyframes artifactGlow {
        0%,
        100% {
          background: linear-gradient(
            135deg,
            rgba(251, 191, 36, 0.08) 0%,
            rgba(245, 158, 11, 0.04) 100%
          );
          border-color: rgba(251, 191, 36, 0.2);
        }
        50% {
          background: linear-gradient(
            135deg,
            rgba(251, 191, 36, 0.12) 0%,
            rgba(245, 158, 11, 0.06) 100%
          );
          border-color: rgba(251, 191, 36, 0.3);
        }
      }

      .artifact-cta-icon {
        font-size: clamp(2rem, 5vw, 2.5rem);
        margin-bottom: 1rem;
        animation: artifactFloat 3s ease-in-out infinite;
      }

      @keyframes artifactFloat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .artifact-cta-title {
        font-size: clamp(1.2rem, 3.5vw, 1.5rem);
        font-weight: 500;
        color: rgba(251, 191, 36, 0.95);
        margin-bottom: 0.5rem;
      }

      .artifact-cta-subtitle {
        font-size: clamp(0.9rem, 2.5vw, 1rem);
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 0.3rem;
      }

      .artifact-cta-description {
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        color: rgba(255, 255, 255, 0.6);
        font-style: italic;
      }

      /* â•­â”€ LOADING SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .loading-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        text-align: center;
      }

      .loading-circle {
        width: clamp(140px, 30vw, 180px);
        height: clamp(140px, 30vw, 180px);
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.15) 0%,
          rgba(255, 255, 255, 0.05) 40%,
          rgba(255, 255, 255, 0.02) 70%,
          transparent 85%
        );
        animation: breatheLoading 4.5s ease-in-out infinite;
        position: relative;
        box-shadow: 0 0 60px rgba(255, 255, 255, 0.1),
          inset 0 0 30px rgba(255, 255, 255, 0.05);
        margin-bottom: 2rem;
      }

      .loading-circle::after {
        content: "";
        position: absolute;
        inset: 25px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.03) 50%,
          transparent 75%
        );
        animation: breatheInner 4.5s ease-in-out infinite;
      }

      @keyframes breatheLoading {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.7;
        }
        50% {
          transform: scale(1.15);
          opacity: 1;
        }
      }

      @keyframes breatheInner {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 0.5;
        }
        50% {
          transform: scale(1.3) rotate(180deg);
          opacity: 0.9;
        }
      }

      .loading-text {
        font-size: clamp(1.1rem, 3vw, 1.4rem);
        font-weight: 300;
        opacity: 0.8;
        letter-spacing: 1px;
        color: rgba(255, 255, 255, 0.85);
        animation: loadingPulse 3s ease-in-out infinite;
      }

      @keyframes loadingPulse {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
      }

      /* â•­â”€ REFLECTION CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .reflection-content {
        display: none;
      }

      .reflection-content.is-visible {
        display: block;
        animation: contentAppear 1s ease-out;
      }

      @keyframes contentAppear {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .admin-notice {
        background: rgba(168, 85, 247, 0.1);
        border: 1px solid rgba(168, 85, 247, 0.25);
        color: #d8b4fe;
        padding: clamp(1rem, 2vw, 1.4rem) clamp(1.5rem, 3vw, 2rem);
        border-radius: 16px;
        margin-bottom: clamp(2rem, 3vw, 2.5rem);
        font-size: clamp(0.85rem, 2vw, 0.95rem);
        font-weight: 400;
        letter-spacing: 0.3px;
        text-align: center;
        animation: adminGlow 4s ease-in-out infinite;
        position: relative;
        overflow: hidden;
      }

      .admin-notice::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(168, 85, 247, 0.1),
          transparent
        );
        transform: translateX(-100%);
        animation: adminShimmer 3s ease-in-out infinite;
      }

      @keyframes adminGlow {
        0%,
        100% {
          background: rgba(168, 85, 247, 0.1);
          border-color: rgba(168, 85, 247, 0.25);
        }
        50% {
          background: rgba(168, 85, 247, 0.15);
          border-color: rgba(168, 85, 247, 0.35);
        }
      }

      @keyframes adminShimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .reflection-backdrop {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.04) 0%,
          rgba(255, 255, 255, 0.015) 100%
        );
        backdrop-filter: blur(50px) saturate(130%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 28px;
        padding: clamp(2rem, 4vw, 3rem) clamp(1.5rem, 3vw, 2.5rem);
        margin-bottom: clamp(2rem, 4vw, 3rem);
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
        position: relative;
        overflow: hidden;
      }

      .mirror-response {
        background: rgba(255, 255, 255, 0.97);
        color: #1a1a2e;
        padding: clamp(2.5rem, 5vw, 3.5rem) clamp(2rem, 4vw, 3rem);
        border-radius: 24px;
        box-shadow: 0 15px 60px rgba(0, 0, 0, 0.25);
        font-size: clamp(1.05rem, 2.5vw, 1.2rem);
        line-height: 1.7;
        font-weight: 300;
        position: relative;
      }

      .mirror-response p {
        margin: 0 0 1.8rem 0;
      }

      .mirror-response p:last-child {
        margin-bottom: 0;
      }

      .mirror-response strong {
        font-weight: 600;
        color: #16213e;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        position: relative;
      }

      .mirror-response em {
        font-style: italic;
        color: #4a5568;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* â•­â”€ ARTIFACT SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .artifact-section {
        margin-top: clamp(3rem, 6vw, 4rem);
        padding: clamp(2rem, 4vw, 3rem);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.04) 0%,
          rgba(255, 255, 255, 0.015) 100%
        );
        backdrop-filter: blur(50px) saturate(130%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 28px;
        position: relative;
        overflow: hidden;
      }

      .artifact-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          rgba(251, 191, 36, 0.6),
          rgba(147, 51, 234, 0.6),
          rgba(59, 130, 246, 0.6)
        );
      }

      .artifact-section-title {
        font-size: clamp(1.6rem, 4vw, 2rem);
        font-weight: 300;
        text-align: center;
        margin-bottom: clamp(2rem, 4vw, 2.5rem);
        color: rgba(255, 255, 255, 0.95);
        position: relative;
      }

      .artifact-section-title::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
      }

      /* Artifact Creation State */
      .artifact-create {
        text-align: center;
      }

      .artifact-create-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        padding: clamp(1.2rem, 3vw, 1.6rem) clamp(2rem, 4vw, 2.5rem);
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.15) 0%,
          rgba(245, 158, 11, 0.1) 100%
        );
        backdrop-filter: blur(25px);
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 20px;
        color: rgba(251, 191, 36, 0.95);
        text-decoration: none;
        font-size: clamp(1rem, 2.5vw, 1.2rem);
        font-weight: 500;
        transition: all 0.4s ease;
        cursor: pointer;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        min-height: 64px;
        position: relative;
        overflow: hidden;
      }

      .artifact-create-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(251, 191, 36, 0.1),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      .artifact-create-button:hover::before {
        transform: translateX(100%);
      }

      .artifact-create-button:hover {
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.25) 0%,
          rgba(245, 158, 11, 0.15) 100%
        );
        border-color: rgba(251, 191, 36, 0.5);
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 15px 40px rgba(251, 191, 36, 0.25);
      }

      .artifact-create-description {
        margin-top: 1.5rem;
        font-size: clamp(0.9rem, 2.2vw, 1rem);
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.6;
      }

      /* Artifact Loading State */
      .artifact-loading {
        display: none;
        text-align: center;
        padding: 2rem 0;
      }

      .artifact-loading.is-visible {
        display: block;
      }

      .artifact-loader {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(251, 191, 36, 0.2) 0%,
          rgba(251, 191, 36, 0.05) 70%,
          transparent 100%
        );
        animation: artifactSpin 2s linear infinite;
        position: relative;
      }

      .artifact-loader::after {
        content: "";
        position: absolute;
        inset: 20%;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(251, 191, 36, 0.4) 0%,
          transparent 70%
        );
        animation: artifactPulse 1.5s ease-in-out infinite;
      }

      @keyframes artifactSpin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes artifactPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.8;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
      }

      .artifact-loading-text {
        font-size: 1.1rem;
        color: rgba(251, 191, 36, 0.9);
        font-weight: 500;
      }

      /* Artifact Preview State */
      .artifact-preview {
        display: none;
      }

      .artifact-preview.is-visible {
        display: block;
        animation: artifactReveal 1s ease-out;
      }

      @keyframes artifactReveal {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .artifact-image-container {
        text-align: center;
        margin-bottom: 2rem;
        position: relative;
      }

      .artifact-image {
        max-width: 100%;
        height: auto;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 2px solid rgba(251, 191, 36, 0.2);
      }

      .artifact-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .artifact-action-button {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        padding: 1rem 1.5rem;
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 16px;
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        font-size: clamp(0.9rem, 2.2vw, 1rem);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        min-height: 48px;
      }

      .artifact-action-button:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      .artifact-action-button.primary {
        background: linear-gradient(135deg, #10b981, #059669);
        border-color: transparent;
        color: white;
      }

      .artifact-action-button.primary:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
      }

      /* â•­â”€ ACTION BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .actions-section {
        margin-top: clamp(3rem, 6vw, 4rem);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: clamp(1rem, 2.5vw, 1.5rem);
      }

      .action-button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: clamp(0.6rem, 1.5vw, 0.8rem);
        padding: clamp(1rem, 2.5vw, 1.4rem) clamp(1.2rem, 3vw, 1.6rem);
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 18px;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
        letter-spacing: 0.4px;
        text-decoration: none;
        font-size: clamp(0.9rem, 2.2vw, 1rem);
        cursor: pointer;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        min-height: 56px;
        min-width: 140px;
      }

      .action-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      .action-button:hover::before {
        transform: translateX(100%);
      }

      .action-button:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 15px 40px rgba(255, 255, 255, 0.15);
      }

      .action-button:active {
        transform: translateY(-1px) scale(0.98);
      }

      .fresh-button {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.15) 0%,
          rgba(5, 150, 105, 0.1) 100%
        ) !important;
        border-color: rgba(16, 185, 129, 0.3) !important;
        color: rgba(16, 185, 129, 0.95) !important;
      }

      .fresh-button:hover {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.25) 0%,
          rgba(5, 150, 105, 0.15) 100%
        ) !important;
        border-color: rgba(16, 185, 129, 0.5) !important;
        box-shadow: 0 15px 40px rgba(16, 185, 129, 0.25) !important;
      }

      /* â•­â”€ FEEDBACK SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .feedback-section {
        margin: 3rem 0;
        padding: 2.5rem;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        transition: all 0.8s ease;
        display: none;
      }

      .feedback-section.is-visible {
        display: block;
        animation: feedbackAppear 0.8s ease-out;
      }

      @keyframes feedbackAppear {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .feedback-content {
        text-align: center;
        max-width: 600px;
        margin: 0 auto;
      }

      .feedback-title {
        font-size: clamp(1.2rem, 3vw, 1.4rem);
        font-weight: 300;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 2rem;
        line-height: 1.4;
      }

      .rating-container {
        display: flex;
        justify-content: center;
        gap: 0.8rem;
        margin-bottom: 0.5rem;
        flex-wrap: wrap;
      }

      .rating-button {
        width: 48px;
        height: 48px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }

      .rating-button:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.4);
        transform: translateY(-2px);
      }

      .rating-button.is-selected {
        background: linear-gradient(135deg, #10b981, #059669);
        border-color: #10b981;
        color: white;
        font-weight: 600;
        transform: scale(1.1);
      }

      .rating-labels {
        display: flex;
        justify-content: space-between;
        max-width: 500px;
        margin: 0 auto 2rem;
        font-size: 0.9rem;
        opacity: 0.6;
      }

      .feedback-textarea {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
        border-radius: 16px;
        padding: 1rem;
        margin-bottom: 2rem;
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.6;
        transition: all 0.3s ease;
      }

      .feedback-textarea:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.08);
      }

      .feedback-textarea::placeholder {
        color: rgba(255, 255, 255, 0.4);
      }

      .feedback-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .feedback-submit,
      .feedback-skip {
        padding: 1rem 2rem;
        border-radius: 16px;
        border: none;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }

      .feedback-submit {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
      }

      .feedback-submit:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
      }

      .feedback-submit:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      .feedback-skip {
        background: transparent;
        color: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .feedback-skip:hover {
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.3);
      }

      /* â•­â”€ RESPONSIVE DESIGN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      @media (max-width: 768px) {
        .actions-section {
          grid-template-columns: 1fr;
          gap: clamp(1rem, 2vw, 1.2rem);
        }

        .feedback-buttons {
          flex-direction: column;
          gap: 1rem;
        }

        .feedback-submit,
        .feedback-skip {
          width: 100%;
        }

        .artifact-actions {
          flex-direction: column;
          align-items: center;
        }

        .artifact-action-button {
          width: 100%;
          max-width: 280px;
        }
      }

      @media (max-width: 480px) {
        .main-container {
          padding: clamp(0.5rem, 2vw, 1rem);
        }

        .reflection-backdrop {
          padding: clamp(1.2rem, 2.5vw, 1.6rem) clamp(0.8rem, 2vw, 1.2rem);
          border-radius: 22px;
        }

        .mirror-response {
          padding: clamp(1.2rem, 2.5vw, 1.6rem) clamp(0.8rem, 2vw, 1.2rem);
          border-radius: 18px;
        }

        .artifact-section {
          padding: clamp(1.2rem, 2.5vw, 1.6rem);
        }
      }

      /* â•­â”€ ACCESSIBILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      .action-button:focus-visible,
      .artifact-create-button:focus-visible,
      .artifact-action-button:focus-visible {
        outline: 2px solid rgba(255, 255, 255, 0.6);
        outline-offset: 2px;
      }

      /* â•­â”€ UTILITY CLASSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .is-hidden {
        display: none !important;
      }
      .is-visible {
        display: block !important;
      }
    </style>
  </head>

  <body>
    <!-- Cosmic Background -->
    <div class="cosmic-background">
      <div class="cosmic-gradient"></div>
    </div>

    <!-- Navigation -->
    <a href="/" class="back-link">
      <span>â†</span>
      <span>Return to Portal</span>
    </a>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Loading Section -->
      <section class="loading-section" id="loadingSection">
        <div class="loading-circle"></div>
        <div class="loading-text">Preparing your reflection...</div>
      </section>

      <!-- Reflection Content -->
      <div class="reflection-content" id="reflectionContent">
        <!-- Artifact CTA Banner -->
        <div class="artifact-cta">
          <div class="artifact-cta-icon">âœ¨</div>
          <div class="artifact-cta-title">Transform Your Truth Into Art</div>
          <div class="artifact-cta-subtitle">
            Create a beautiful visual artifact from your reflection
          </div>
          <div class="artifact-cta-description">
            See your personalized artwork below
          </div>
        </div>

        <!-- Admin Notice -->
        <div class="admin-notice is-hidden" id="adminNotice">
          <span>âœ¨ Creator mode â€” unlimited premium reflections</span>
        </div>

        <!-- Mirror Response -->
        <div class="reflection-backdrop">
          <div class="mirror-response" id="mirrorResponse">
            <!-- Reflection content will be loaded here -->
          </div>
        </div>

        <!-- Artifact Section -->
        <div class="artifact-section">
          <h2 class="artifact-section-title">Your Sacred Artifact</h2>

          <!-- Artifact Creation State -->
          <div class="artifact-create" id="artifactCreate">
            <button class="artifact-create-button" id="createArtifactButton">
              <span>ğŸ¨</span>
              <span>Create Your Artifact</span>
            </button>
            <div class="artifact-create-description">
              Transform your reflection into a personalized visual that captures
              your essence and insights
            </div>
          </div>

          <!-- Artifact Loading State -->
          <div class="artifact-loading" id="artifactLoading">
            <div class="artifact-loader"></div>
            <div class="artifact-loading-text">Creating your artifact...</div>
          </div>

          <!-- Artifact Preview State -->
          <div class="artifact-preview" id="artifactPreview">
            <div class="artifact-image-container">
              <img
                id="artifactImage"
                class="artifact-image"
                alt="Your Sacred Artifact"
              />
            </div>
            <div class="artifact-actions">
              <a
                id="downloadArtifactButton"
                class="artifact-action-button primary"
                download
              >
                <span>â¬‡ï¸</span>
                <span>Download</span>
              </a>
              <button id="shareArtifactButton" class="artifact-action-button">
                <span>ğŸ”—</span>
                <span>Share</span>
              </button>
              <button
                id="regenerateArtifactButton"
                class="artifact-action-button"
              >
                <span>ğŸ”„</span>
                <span>Regenerate</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="actions-section">
          <button class="action-button" id="emailButton">
            <span>ğŸ“§</span><span>Mail Reflection</span>
          </button>
          <button
            class="action-button fresh-button"
            onclick="window.location.href='/reflection'"
          >
            <span>ğŸ†•</span><span>New Reflection</span>
          </button>
          <a href="/reflections/history" class="action-button">
            <span>ğŸ“š</span><span>Your Journey</span>
          </a>
          <a href="/behind-the-mirror" class="action-button">
            <span>ğŸ¤²</span><span>Who created this?</span>
          </a>
        </div>

        <!-- Feedback Section -->
        <div class="feedback-section" id="feedbackSection">
          <div class="feedback-content">
            <h3 class="feedback-title">
              How deeply did this help you access your truth?
            </h3>
            <div class="rating-container">
              <button class="rating-button" data-rating="1">1</button>
              <button class="rating-button" data-rating="2">2</button>
              <button class="rating-button" data-rating="3">3</button>
              <button class="rating-button" data-rating="4">4</button>
              <button class="rating-button" data-rating="5">5</button>
              <button class="rating-button" data-rating="6">6</button>
              <button class="rating-button" data-rating="7">7</button>
              <button class="rating-button" data-rating="8">8</button>
              <button class="rating-button" data-rating="9">9</button>
              <button class="rating-button" data-rating="10">10</button>
            </div>
            <div class="rating-labels">
              <span>Not at all</span>
              <span>Deeply</span>
            </div>
            <textarea
              class="feedback-textarea"
              id="feedbackTextarea"
              placeholder="What emerged for you? (optional)"
              maxlength="500"
              rows="3"
            ></textarea>
            <div class="feedback-buttons">
              <button class="feedback-submit" id="feedbackSubmit" type="button">
                Submit & Continue
              </button>
              <button class="feedback-skip" id="feedbackSkip" type="button">
                Skip
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REFLECTION OUTPUT - COMPLETE SCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

      "use strict";

      // â•­â”€ GLOBAL STATE MANAGER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      class ReflectionOutputState {
        constructor() {
          this.userData = null;
          this.authToken = null;
          this.currentReflectionId = null;
          this.currentReflection = null;
          this.artifactData = null;
        }

        setCurrentUser(userId, userData) {
          this.userData = userData;
        }
      }

      // â•­â”€ MAIN APPLICATION CLASS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      class ReflectionOutputApplication {
        constructor() {
          this.state = new ReflectionOutputState();
        }

        async init() {
          console.log("ğŸª Initializing Reflection Output...");

          try {
            await this.initializeAuthentication();
            this.extractReflectionId();
            await this.loadReflection();
            this.setupEventListeners();

            console.log("âœ¨ Reflection Output initialization complete");
          } catch (error) {
            console.error("ğŸ’¥ Initialization failed:", error);
            this.handleInitializationError(error);
          }
        }

        async initializeAuthentication() {
          const urlParams = new URLSearchParams(window.location.search);
          const mode = urlParams.get("mode");
          const premium = urlParams.get("premium");

          this.state.authToken = localStorage.getItem("mirror_auth_token");

          if (mode === "creator") {
            const userData = {
              isCreator: true,
              name: "Ahiya",
              email: "ahiya.butman@gmail.com",
              tier: "premium",
              id: "creator_ahiya",
            };
            this.state.setCurrentUser(userData.id, userData);
            this.showAdminNotice(
              "âœ¨ Creator mode â€” unlimited premium reflections"
            );
          } else if (mode === "user") {
            const userData = {
              name: "Test User",
              email: "test@example.com",
              tier: premium === "true" ? "premium" : "essential",
              testMode: true,
              id: `test_user_${Date.now()}`,
            };
            this.state.setCurrentUser(userData.id, userData);
            this.showAdminNotice(
              `ğŸŒŸ Test mode â€” ${
                premium === "true" ? "premium" : "essential"
              } reflection`
            );
          } else if (!this.state.authToken) {
            this.redirectToAuth("Authentication required for reflections");
            return;
          } else {
            try {
              const userData = await this.verifyAuthToken();
              this.state.setCurrentUser(userData.id, userData);
            } catch (error) {
              this.redirectToAuth(
                "Authentication failed, please sign in again"
              );
              return;
            }
          }

          console.log("ğŸ” Authentication complete:", {
            user: this.state.userData?.name || "Anonymous",
            tier: this.state.userData?.tier || "unknown",
          });
        }

        async verifyAuthToken() {
          const response = await fetch("/api/auth", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${this.state.authToken}`,
            },
            body: JSON.stringify({ action: "verify-token" }),
          });

          const result = await response.json();
          if (!result.success || !result.user) {
            throw new Error("Token verification failed");
          }

          return result.user;
        }

        redirectToAuth(message) {
          alert(message);
          const returnUrl = encodeURIComponent(
            window.location.pathname + window.location.search
          );
          window.location.href = `/auth/signin?returnTo=${returnUrl}`;
        }

        showAdminNotice(message) {
          const notice = document.getElementById("adminNotice");
          notice.classList.remove("is-hidden");
          notice.innerHTML = `<span>${message}</span>`;
        }

        extractReflectionId() {
          const urlParams = new URLSearchParams(window.location.search);
          this.state.currentReflectionId = urlParams.get("id");

          if (!this.state.currentReflectionId) {
            throw new Error("No reflection ID provided");
          }
        }

        async loadReflection() {
          if (!this.state.currentReflectionId) return;

          try {
            const headers = { "Content-Type": "application/json" };
            if (this.state.authToken) {
              headers["Authorization"] = `Bearer ${this.state.authToken}`;
            }

            const response = await fetch(
              `/api/reflections/${this.state.currentReflectionId}`,
              {
                method: "GET",
                headers: headers,
              }
            );

            if (!response.ok) {
              throw new Error(`Failed to fetch reflection: ${response.status}`);
            }

            const data = await response.json();

            if (!data.success || !data.reflection) {
              throw new Error("Invalid reflection response");
            }

            this.state.currentReflection = data.reflection;
            this.displayReflection();
            await this.checkExistingArtifact();

            // Hide loading, show content
            document.getElementById("loadingSection").style.display = "none";
            document
              .getElementById("reflectionContent")
              .classList.add("is-visible");

            // Show feedback after delay
            setTimeout(() => this.showFeedbackSection(), 3000);
          } catch (error) {
            console.error("Failed to load reflection:", error);
            throw new Error("Unable to load reflection");
          }
        }

        displayReflection() {
          if (!this.state.currentReflection) return;

          // Display the mirror's response
          const responseElement = document.getElementById("mirrorResponse");
          if (this.state.currentReflection.ai_response) {
            responseElement.innerHTML =
              this.state.currentReflection.ai_response;
          } else {
            responseElement.textContent = "No reflection content available.";
          }

          console.log("âœ… Reflection displayed successfully");
        }

        async checkExistingArtifact() {
          try {
            const headers = { "Content-Type": "application/json" };
            if (this.state.authToken) {
              headers["Authorization"] = `Bearer ${this.state.authToken}`;
            }

            const response = await fetch("/api/artifact", {
              method: "POST",
              headers: headers,
              body: JSON.stringify({
                action: "check-existing",
                reflectionId: this.state.currentReflectionId,
              }),
            });

            const data = await response.json();

            if (data.success && data.artifact) {
              this.state.artifactData = data.artifact;
              this.showArtifactPreview(data.artifact);
            }
          } catch (error) {
            console.log("No existing artifact found");
          }
        }

        setupEventListeners() {
          console.log("ğŸ‘‚ Setting up event listeners...");

          // Artifact creation
          document
            .getElementById("createArtifactButton")
            .addEventListener("click", (e) => {
              e.preventDefault();
              this.createArtifact();
            });

          // Email reflection
          document
            .getElementById("emailButton")
            .addEventListener("click", (e) => {
              e.preventDefault();
              this.emailReflection();
            });

          // Artifact actions
          document
            .getElementById("shareArtifactButton")
            .addEventListener("click", () => {
              this.shareArtifact();
            });

          document
            .getElementById("regenerateArtifactButton")
            .addEventListener("click", () => {
              this.regenerateArtifact();
            });

          // Feedback system
          this.setupFeedbackInteractions();

          console.log("âœ… Event listeners setup complete");
        }

        async createArtifact() {
          if (!this.state.currentReflectionId) {
            alert("No reflection found to create artifact from.");
            return;
          }

          console.log("ğŸ¨ Creating artifact...");

          // Show loading state
          document.getElementById("artifactCreate").style.display = "none";
          document
            .getElementById("artifactLoading")
            .classList.add("is-visible");

          try {
            const headers = { "Content-Type": "application/json" };
            if (this.state.authToken) {
              headers["Authorization"] = `Bearer ${this.state.authToken}`;
            }

            const response = await fetch("/api/artifact", {
              method: "POST",
              headers: headers,
              body: JSON.stringify({
                reflectionId: this.state.currentReflectionId,
              }),
            });

            const data = await response.json();

            if (data.success && data.artifact) {
              console.log("âœ¨ Artifact created successfully!");
              this.state.artifactData = data.artifact;
              this.showArtifactPreview(data.artifact);
            } else {
              throw new Error(data.error || "Artifact creation failed");
            }
          } catch (error) {
            console.error("ğŸ’¥ Artifact creation failed:", error);
            alert("Failed to create artifact. Please try again.");

            // Reset to creation state
            document
              .getElementById("artifactLoading")
              .classList.remove("is-visible");
            document.getElementById("artifactCreate").style.display = "block";
          }
        }

        showArtifactPreview(artifact) {
          // Hide loading and creation states
          document.getElementById("artifactCreate").style.display = "none";
          document
            .getElementById("artifactLoading")
            .classList.remove("is-visible");

          // Set up preview
          const artifactImage = document.getElementById("artifactImage");
          const downloadButton = document.getElementById(
            "downloadArtifactButton"
          );

          artifactImage.src = artifact.image_url;
          artifactImage.alt = "Your Sacred Artifact";

          downloadButton.href = artifact.image_url;
          downloadButton.download = `mirror-artifact-${Date.now()}.png`;

          // Show preview
          document
            .getElementById("artifactPreview")
            .classList.add("is-visible");
        }

        async emailReflection() {
          const button = document.getElementById("emailButton");
          const originalContent = button.innerHTML;

          button.innerHTML = "<span>ğŸ“§</span><span>Sending...</span>";
          button.disabled = true;

          try {
            const response = await fetch("/api/communication", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                action: "send-reflection",
                email: this.state.userData.email,
                content: document.getElementById("mirrorResponse").innerHTML,
                userName: this.state.userData.name || "Friend",
                language: "en",
                isPremium:
                  this.state.userData.tier === "premium" ||
                  this.state.userData.isCreator,
              }),
            });

            const data = await response.json();

            if (data.success) {
              button.innerHTML = "<span>âœ…</span><span>Sent!</span>";
            } else {
              throw new Error(data.error || "Email failed");
            }
          } catch (error) {
            console.error("ğŸ’¥ Email failed:", error);
            button.innerHTML = "<span>âš¡</span><span>Try Again</span>";
          } finally {
            setTimeout(() => {
              button.innerHTML = originalContent;
              button.disabled = false;
            }, 3000);
          }
        }

        shareArtifact() {
          if (!this.state.artifactData?.image_url) return;

          const url = this.state.artifactData.image_url;

          if (navigator.share) {
            navigator
              .share({
                title: "My Mirror of Truth Artifact",
                text: "Check out my personalized reflection artifact",
                url: url,
              })
              .catch((err) => {
                console.log("Share failed:", err);
                this.copyToClipboard(url);
              });
          } else {
            this.copyToClipboard(url);
          }
        }

        copyToClipboard(text) {
          if (navigator.clipboard) {
            navigator.clipboard
              .writeText(text)
              .then(() => {
                alert("ğŸ”— Link copied to clipboard");
              })
              .catch(() => {
                this.fallbackCopyToClipboard(text);
              });
          } else {
            this.fallbackCopyToClipboard(text);
          }
        }

        fallbackCopyToClipboard(text) {
          const textArea = document.createElement("textarea");
          textArea.value = text;
          textArea.style.position = "fixed";
          textArea.style.left = "-999999px";
          textArea.style.top = "-999999px";
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          try {
            document.execCommand("copy");
            alert("ğŸ”— Link copied to clipboard");
          } catch (err) {
            alert("âŒ Unable to copy link");
          }

          document.body.removeChild(textArea);
        }

        async regenerateArtifact() {
          if (
            !confirm(
              "Are you sure you want to create a new artifact? This will replace your current one."
            )
          ) {
            return;
          }

          // Reset to creation state and recreate
          document
            .getElementById("artifactPreview")
            .classList.remove("is-visible");
          this.state.artifactData = null;
          await this.createArtifact();
        }

        showFeedbackSection() {
          if (
            document
              .getElementById("feedbackSection")
              .classList.contains("is-visible")
          )
            return;

          console.log("ğŸ’­ Showing feedback section...");
          document
            .getElementById("feedbackSection")
            .classList.add("is-visible");
        }

        setupFeedbackInteractions() {
          let selectedRating = null;

          // Rating buttons
          document.querySelectorAll(".rating-button").forEach((button) => {
            button.addEventListener("click", () => {
              document.querySelectorAll(".rating-button").forEach((btn) => {
                btn.classList.remove("is-selected");
              });
              button.classList.add("is-selected");
              selectedRating = parseInt(button.dataset.rating);
            });
          });

          // Submit feedback
          document
            .getElementById("feedbackSubmit")
            .addEventListener("click", async () => {
              if (!selectedRating) {
                alert("Please select a rating from 1-10");
                return;
              }

              await this.submitFeedback(selectedRating);
            });

          // Skip feedback
          document
            .getElementById("feedbackSkip")
            .addEventListener("click", () => {
              this.hideFeedbackSection();
            });
        }

        async submitFeedback(rating) {
          const feedbackText = document
            .getElementById("feedbackTextarea")
            .value.trim();

          try {
            const response = await fetch("/api/reflections", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${this.state.authToken}`,
              },
              body: JSON.stringify({
                action: "submit-feedback",
                reflectionId: this.state.currentReflectionId,
                rating: rating,
                feedback: feedbackText,
              }),
            });

            const data = await response.json();

            if (data.success) {
              console.log("âœ… Feedback submitted successfully");
              const submitButton = document.getElementById("feedbackSubmit");
              submitButton.textContent = "âœ“ Thank you!";
              submitButton.disabled = true;
              setTimeout(() => this.hideFeedbackSection(), 1500);
            } else {
              console.error("ğŸ’¥ Failed to submit feedback:", data.error);
              this.hideFeedbackSection();
            }
          } catch (error) {
            console.error("ğŸ’¥ Feedback submission error:", error);
            this.hideFeedbackSection();
          }
        }

        hideFeedbackSection() {
          const feedbackSection = document.getElementById("feedbackSection");
          if (feedbackSection) {
            feedbackSection.style.transition = "all 0.5s ease";
            feedbackSection.style.opacity = "0";
            feedbackSection.style.transform = "translateY(-20px)";
            setTimeout(() => feedbackSection.remove(), 500);
          }
        }

        handleInitializationError(error) {
          console.error("ğŸ’¥ Fatal initialization error:", error);
          document.body.innerHTML = `
            <div style="
              position: fixed;
              inset: 0;
              background: #020617;
              color: white;
              display: flex;
              align-items: center;
              justify-content: center;
              flex-direction: column;
              gap: 2rem;
              text-align: center;
              padding: 2rem;
            ">
              <h1 style="font-size: 2rem; margin: 0;">Reflection Unavailable</h1>
              <p style="margin: 0; opacity: 0.8;">Unable to load your reflection. Please try again.</p>
              <button onclick="window.location.href='/reflection'" style="
                padding: 1rem 2rem;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 16px;
                color: white;
                cursor: pointer;
                font-size: 1rem;
              ">Try New Reflection</button>
            </div>
          `;
        }
      }

      // â•­â”€ APPLICATION INITIALIZATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      let reflectionOutputApp;

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeApp);
      } else {
        initializeApp();
      }

      function initializeApp() {
        try {
          reflectionOutputApp = new ReflectionOutputApplication();
          reflectionOutputApp.init();
        } catch (error) {
          console.error("ğŸ’¥ Failed to initialize Reflection Output:", error);
        }
      }

      window.reflectionOutputApp = reflectionOutputApp;
      console.log("ğŸª Reflection Output script loaded and ready");
    </script>
  </body>
</html>
