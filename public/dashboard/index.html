<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <title>Your Sacred Journey | Mirror of Truth</title>

    <style>
      /* Mesmerizing Dashboard - Perfect Contained Experience */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100vh;
        overflow: hidden;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 25%,
          #16213e 50%,
          #0f0f23 100%
        );
        color: #fff;
        font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
        position: fixed;
        width: 100vw;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Cosmic Mirror Shards - Enhanced Animation */
      .cosmic-mirrors {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 1;
        overflow: hidden;
      }

      .cosmic-mirror {
        position: absolute;
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(255, 255, 255, 0.05);
        animation: cosmicFloat 20s ease-in-out infinite;
        transition: all 0.4s ease;
      }

      .cosmic-mirror:nth-child(1) {
        width: clamp(20px, 3vw, 35px);
        height: clamp(20px, 3vw, 35px);
        top: 8%;
        left: 12%;
        clip-path: polygon(30% 0%, 85% 15%, 100% 70%, 45% 100%, 0% 65%);
        animation-delay: 0s;
        animation-duration: 22s;
      }

      .cosmic-mirror:nth-child(2) {
        width: clamp(15px, 2.5vw, 28px);
        height: clamp(15px, 2.5vw, 28px);
        top: 15%;
        right: 18%;
        clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
        animation-delay: 3s;
        animation-duration: 18s;
      }

      .cosmic-mirror:nth-child(3) {
        width: clamp(25px, 4vw, 40px);
        height: clamp(25px, 4vw, 40px);
        top: 35%;
        left: 8%;
        clip-path: polygon(25% 0%, 100% 25%, 75% 100%, 0% 75%);
        animation-delay: 6s;
        animation-duration: 25s;
      }

      .cosmic-mirror:nth-child(4) {
        width: clamp(18px, 3.2vw, 32px);
        height: clamp(18px, 3.2vw, 32px);
        top: 55%;
        right: 12%;
        clip-path: polygon(20% 0%, 80% 20%, 100% 80%, 20% 100%, 0% 80%);
        animation-delay: 9s;
        animation-duration: 20s;
      }

      .cosmic-mirror:nth-child(5) {
        width: clamp(22px, 3.5vw, 38px);
        height: clamp(22px, 3.5vw, 38px);
        bottom: 20%;
        left: 25%;
        clip-path: polygon(40% 0%, 85% 25%, 100% 75%, 60% 100%, 0% 50%);
        animation-delay: 12s;
        animation-duration: 24s;
      }

      .cosmic-mirror:nth-child(6) {
        width: clamp(16px, 2.8vw, 30px);
        height: clamp(16px, 2.8vw, 30px);
        bottom: 12%;
        right: 35%;
        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        animation-delay: 15s;
        animation-duration: 19s;
      }

      @keyframes cosmicFloat {
        0%,
        100% {
          transform: translateY(0) translateX(0) rotate(0deg) scale(1);
          opacity: 0.3;
        }
        25% {
          transform: translateY(-15px) translateX(8px) rotate(90deg) scale(1.1);
          opacity: 0.6;
        }
        50% {
          transform: translateY(-8px) translateX(-12px) rotate(180deg)
            scale(0.9);
          opacity: 0.8;
        }
        75% {
          transform: translateY(-20px) translateX(5px) rotate(270deg)
            scale(1.05);
          opacity: 0.5;
        }
      }

      /* Enhanced shimmer effect */
      .cosmic-mirror::after {
        content: "";
        position: absolute;
        inset: -20%;
        background: linear-gradient(
          45deg,
          rgba(147, 51, 234, 0.2) 0%,
          transparent 30%,
          rgba(59, 130, 246, 0.15) 60%,
          transparent 100%
        );
        animation: cosmicShimmer 12s linear infinite;
        mix-blend-mode: overlay;
        border-radius: inherit;
      }

      @keyframes cosmicShimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(-45deg);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: translateX(200%) translateY(200%) rotate(-45deg);
          opacity: 0;
        }
      }

      /* Floating Particles for Extra Magic */
      .cosmic-particles {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 2;
      }

      .cosmic-particle {
        position: absolute;
        width: 2px;
        height: 2px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 50%;
        animation: particleFloat 15s linear infinite;
      }

      .cosmic-particle:nth-child(1) {
        left: 15%;
        animation-delay: 0s;
        background: rgba(147, 51, 234, 0.3);
      }

      .cosmic-particle:nth-child(2) {
        left: 45%;
        animation-delay: 5s;
        background: rgba(59, 130, 246, 0.3);
      }

      .cosmic-particle:nth-child(3) {
        left: 75%;
        animation-delay: 10s;
        background: rgba(16, 185, 129, 0.3);
      }

      @keyframes particleFloat {
        0% {
          transform: translateY(100vh) scale(0);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 0.6;
        }
        100% {
          transform: translateY(-10vh) scale(1);
          opacity: 0;
        }
      }

      /* Navigation Bar - Ultra Compact */
      .nav-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        height: clamp(60px, 8vh, 80px);
        background: rgba(15, 15, 35, 0.8);
        backdrop-filter: blur(30px) saturate(120%);
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 clamp(1rem, 3vw, 2rem);
      }

      .nav-left {
        display: flex;
        align-items: center;
        gap: clamp(0.8rem, 2vw, 1.2rem);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        text-decoration: none;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 400;
        font-size: clamp(0.9rem, 2.2vw, 1.1rem);
        transition: all 0.3s ease;
      }

      .logo:hover {
        color: rgba(255, 255, 255, 1);
        transform: translateY(-1px);
      }

      .mirror-logo {
        font-size: clamp(1.2rem, 3vw, 1.6rem);
        animation: logoGlow 4s ease-in-out infinite;
      }

      @keyframes logoGlow {
        0%,
        100% {
          filter: drop-shadow(0 0 8px rgba(147, 51, 234, 0.3));
          transform: scale(1);
        }
        50% {
          filter: drop-shadow(0 0 12px rgba(147, 51, 234, 0.5));
          transform: scale(1.05);
        }
      }

      .nav-links {
        display: flex;
        gap: clamp(0.4rem, 1vw, 0.6rem);
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: clamp(0.4rem, 1vh, 0.6rem) clamp(0.8rem, 2vw, 1rem);
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        font-size: clamp(0.7rem, 1.8vw, 0.85rem);
        font-weight: 300;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .nav-link:hover,
      .nav-link.active {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.15);
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-1px);
      }

      .nav-right {
        display: flex;
        align-items: center;
        gap: clamp(0.6rem, 1.5vw, 1rem);
      }

      .upgrade-btn {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: clamp(0.4rem, 1vh, 0.6rem) clamp(0.8rem, 2vw, 1rem);
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.15),
          rgba(217, 119, 6, 0.1)
        );
        border: 1px solid rgba(245, 158, 11, 0.3);
        border-radius: 20px;
        color: rgba(251, 191, 36, 0.9);
        text-decoration: none;
        font-size: clamp(0.7rem, 1.8vw, 0.85rem);
        font-weight: 400;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .upgrade-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.2),
          rgba(217, 119, 6, 0.15)
        );
        border-color: rgba(245, 158, 11, 0.4);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
      }

      /* User Menu */
      .user-menu {
        position: relative;
      }

      .user-btn {
        display: flex;
        align-items: center;
        gap: clamp(0.4rem, 1vw, 0.6rem);
        padding: clamp(0.4rem, 1vh, 0.6rem) clamp(0.8rem, 2vw, 1rem);
        background: rgba(16, 185, 129, 0.08);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 20px;
        color: rgba(255, 255, 255, 0.9);
        cursor: pointer;
        font-size: clamp(0.7rem, 1.8vw, 0.85rem);
        font-weight: 300;
        transition: all 0.3s ease;
        white-space: nowrap;
        background: none;
      }

      .user-btn:hover {
        background: rgba(16, 185, 129, 0.12);
        border-color: rgba(16, 185, 129, 0.3);
        transform: translateY(-1px);
      }

      .user-avatar {
        font-size: clamp(0.9rem, 2.2vw, 1.1rem);
      }

      .dropdown-arrow {
        font-size: clamp(0.5rem, 1.2vw, 0.7rem);
        opacity: 0.7;
        transition: transform 0.3s ease;
      }

      .user-menu.open .dropdown-arrow {
        transform: rotate(180deg);
      }

      .user-dropdown {
        position: absolute;
        top: calc(100% + 0.5rem);
        right: 0;
        min-width: 200px;
        background: rgba(15, 15, 35, 0.95);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 16px;
        padding: 0.5rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 200;
      }

      .user-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        padding: 0.6rem 0.8rem;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 0.8rem;
        cursor: pointer;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
      }

      .dropdown-item:hover {
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.95);
      }

      /* Main Dashboard - Perfect Fit */
      .dashboard-main {
        position: relative;
        z-index: 10;
        height: 100vh;
        padding-top: clamp(60px, 8vh, 80px);
        display: flex;
        flex-direction: column;
      }

      .dashboard-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: clamp(0.8rem, 2vh, 1.5rem) clamp(1rem, 3vw, 2rem);
        gap: clamp(0.8rem, 2vh, 1.2rem);
        overflow: hidden;
      }

      /* Welcome Section - Compact but Impactful */
      .welcome-section {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: clamp(1rem, 2.5vh, 1.8rem) clamp(1.2rem, 3vw, 2rem);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.06) 0%,
          rgba(147, 51, 234, 0.03) 50%,
          rgba(255, 255, 255, 0.02) 100%
        );
        backdrop-filter: blur(40px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: clamp(16px, 3vw, 24px);
        position: relative;
        overflow: hidden;
        animation: welcomeGlow 1s ease-out;
      }

      @keyframes welcomeGlow {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .welcome-section::before {
        content: "";
        position: absolute;
        inset: 1px;
        background: linear-gradient(
          135deg,
          rgba(147, 51, 234, 0.04) 0%,
          transparent 50%,
          rgba(59, 130, 246, 0.02) 100%
        );
        border-radius: clamp(15px, 3vw, 23px);
        pointer-events: none;
        animation: welcomeShimmer 8s ease-in-out infinite;
      }

      @keyframes welcomeShimmer {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.7;
        }
      }

      .welcome-content {
        flex: 1;
        position: relative;
        z-index: 2;
      }

      .welcome-title {
        font-size: clamp(1.4rem, 3.5vw, 2rem);
        font-weight: 300;
        margin-bottom: clamp(0.3rem, 0.8vh, 0.5rem);
        line-height: 1.2;
      }

      .greeting {
        color: rgba(255, 255, 255, 0.7);
        display: block;
        font-size: clamp(0.8rem, 2vw, 1rem);
        margin-bottom: 0.2rem;
      }

      .user-name-display {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95) 0%,
          rgba(147, 51, 234, 0.8) 100%
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        display: block;
      }

      .welcome-subtitle {
        font-size: clamp(0.75rem, 1.8vw, 0.9rem);
        color: rgba(255, 255, 255, 0.6);
        margin: 0;
        font-weight: 300;
        line-height: 1.4;
      }

      .quick-actions {
        display: flex;
        gap: clamp(0.6rem, 1.5vw, 0.8rem);
        flex-shrink: 0;
        position: relative;
        z-index: 2;
      }

      .action-btn {
        display: flex;
        align-items: center;
        gap: clamp(0.4rem, 1vw, 0.6rem);
        padding: clamp(0.6rem, 1.5vh, 0.9rem) clamp(1rem, 2.5vw, 1.4rem);
        border: none;
        border-radius: clamp(10px, 2vw, 14px);
        font-size: clamp(0.75rem, 1.8vw, 0.9rem);
        font-weight: 400;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        white-space: nowrap;
        position: relative;
        overflow: hidden;
      }

      .action-btn::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      .action-btn:hover::before {
        transform: translateX(100%);
      }

      .action-btn.primary {
        background: linear-gradient(
          135deg,
          rgba(147, 51, 234, 0.2),
          rgba(99, 102, 241, 0.15)
        );
        border: 1px solid rgba(147, 51, 234, 0.3);
        color: rgba(196, 181, 253, 0.9);
      }

      .action-btn.primary:hover {
        background: linear-gradient(
          135deg,
          rgba(147, 51, 234, 0.3),
          rgba(99, 102, 241, 0.2)
        );
        border-color: rgba(147, 51, 234, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(147, 51, 234, 0.2);
      }

      .action-btn.secondary {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.04)
        );
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.8);
      }

      .action-btn.secondary:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.12),
          rgba(255, 255, 255, 0.06)
        );
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1);
      }

      /* Dashboard Grid - 2x2 Compact Layout */
      .dashboard-grid {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: clamp(0.8rem, 2vh, 1.2rem);
        min-height: 0;
      }

      /* Dashboard Cards - Compact but Premium */
      .dashboard-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.05) 0%,
          rgba(255, 255, 255, 0.02) 100%
        );
        backdrop-filter: blur(40px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: clamp(14px, 2.8vw, 20px);
        padding: clamp(1rem, 2.5vh, 1.4rem);
        position: relative;
        overflow: hidden;
        transition: all 0.4s ease;
        animation: cardFloat 0.8s ease-out;
        animation-fill-mode: backwards;
        display: flex;
        flex-direction: column;
      }

      .dashboard-card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .dashboard-card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .dashboard-card:nth-child(3) {
        animation-delay: 0.3s;
      }
      .dashboard-card:nth-child(4) {
        animation-delay: 0.4s;
      }

      @keyframes cardFloat {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .dashboard-card::before {
        content: "";
        position: absolute;
        inset: 1px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.06) 0%,
          rgba(255, 255, 255, 0.01) 100%
        );
        border-radius: clamp(13px, 2.8vw, 19px);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .dashboard-card:hover::before {
        opacity: 1;
      }

      .dashboard-card:hover {
        border-color: rgba(255, 255, 255, 0.15);
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 255, 255, 0.06);
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: clamp(0.8rem, 2vh, 1.2rem);
        position: relative;
        z-index: 2;
        flex-shrink: 0;
      }

      .card-title {
        display: flex;
        align-items: center;
        gap: clamp(0.4rem, 1vw, 0.6rem);
        font-size: clamp(0.9rem, 2.2vw, 1.1rem);
        font-weight: 400;
        color: rgba(255, 255, 255, 0.95);
        margin: 0;
      }

      .card-icon {
        font-size: clamp(1rem, 2.5vw, 1.3rem);
        opacity: 0.9;
        animation: iconGlow 3s ease-in-out infinite;
      }

      @keyframes iconGlow {
        0%,
        100% {
          filter: drop-shadow(0 0 4px rgba(147, 51, 234, 0.3));
        }
        50% {
          filter: drop-shadow(0 0 8px rgba(147, 51, 234, 0.5));
        }
      }

      .header-action {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        padding: clamp(0.3rem, 0.8vh, 0.5rem) clamp(0.6rem, 1.5vw, 0.8rem);
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.7);
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .header-action:hover {
        background: rgba(255, 255, 255, 0.08);
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-1px);
      }

      .card-content {
        position: relative;
        z-index: 2;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      /* Usage Card - Compact Circular Progress */
      .usage-display {
        display: flex;
        align-items: center;
        gap: clamp(1rem, 2.5vw, 1.5rem);
        margin-bottom: clamp(0.8rem, 2vh, 1rem);
        flex: 1;
        min-height: 0;
      }

      .usage-chart {
        flex-shrink: 0;
      }

      .progress-circle {
        width: clamp(70px, 15vw, 90px);
        height: clamp(70px, 15vw, 90px);
        border-radius: 50%;
        background: conic-gradient(
          from 0deg,
          rgba(147, 51, 234, 0.8) 0%,
          rgba(147, 51, 234, 0.8) var(--progress, 0%),
          rgba(255, 255, 255, 0.08) var(--progress, 0%),
          rgba(255, 255, 255, 0.08) 100%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        animation: progressSpin 2s ease-out;
      }

      @keyframes progressSpin {
        from {
          transform: rotate(-90deg);
        }
        to {
          transform: rotate(0deg);
        }
      }

      .progress-circle::before {
        content: "";
        width: clamp(55px, 12vw, 70px);
        height: clamp(55px, 12vw, 70px);
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(15, 15, 35, 0.95) 0%,
          rgba(26, 26, 46, 0.95) 100%
        );
        position: absolute;
      }

      .progress-value {
        font-size: clamp(0.9rem, 2.2vw, 1.1rem);
        font-weight: 600;
        color: rgba(255, 255, 255, 0.9);
        position: relative;
        z-index: 1;
      }

      .usage-stats {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: clamp(0.4rem, 1vh, 0.6rem);
        min-width: 0;
      }

      .stat-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .stat-label {
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        color: rgba(255, 255, 255, 0.6);
      }

      .stat-value {
        font-size: clamp(0.8rem, 2vw, 1rem);
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
      }

      .usage-actions {
        text-align: center;
        flex-shrink: 0;
      }

      .usage-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: clamp(0.5rem, 1.2vh, 0.7rem) clamp(0.8rem, 2vw, 1.2rem);
        background: rgba(147, 51, 234, 0.1);
        border: 1px solid rgba(147, 51, 234, 0.2);
        border-radius: 10px;
        color: rgba(196, 181, 253, 0.9);
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .usage-btn:hover {
        background: rgba(147, 51, 234, 0.15);
        color: rgba(196, 181, 253, 1);
        transform: translateY(-1px);
      }

      /* Reflections Card - Compact List */
      .reflections-list {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: clamp(0.5rem, 1.2vh, 0.8rem);
        overflow-y: auto;
        padding-right: clamp(0.2rem, 0.5vw, 0.4rem);
        min-height: 0;
      }

      .reflection-item {
        padding: clamp(0.6rem, 1.5vh, 0.9rem);
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: clamp(8px, 1.6vw, 12px);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        animation: reflectionSlide 0.5s ease-out;
      }

      @keyframes reflectionSlide {
        from {
          opacity: 0;
          transform: translateX(-15px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .reflection-item:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.12);
        transform: translateX(3px);
      }

      .reflection-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: clamp(0.3rem, 0.8vh, 0.5rem);
        gap: clamp(0.5rem, 1.2vw, 0.8rem);
      }

      .reflection-title {
        font-size: clamp(0.75rem, 1.8vw, 0.85rem);
        font-weight: 400;
        color: rgba(255, 255, 255, 0.9);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        flex: 1;
        line-height: 1.3;
      }

      .reflection-date {
        font-size: clamp(0.65rem, 1.5vw, 0.75rem);
        color: rgba(255, 255, 255, 0.5);
        flex-shrink: 0;
      }

      .reflection-preview {
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.3;
        margin-bottom: clamp(0.4rem, 1vh, 0.6rem);
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .reflection-meta {
        display: flex;
        align-items: center;
        gap: clamp(0.4rem, 1vw, 0.6rem);
      }

      .reflection-tone {
        font-size: clamp(0.6rem, 1.4vw, 0.7rem);
        padding: clamp(0.15rem, 0.4vh, 0.2rem) clamp(0.4rem, 1vw, 0.6rem);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.08);
        color: rgba(255, 255, 255, 0.8);
        text-transform: capitalize;
      }

      .reflection-tone.fusion {
        background: rgba(251, 191, 36, 0.15);
        color: rgba(251, 191, 36, 0.9);
      }

      .reflection-tone.gentle {
        background: rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.9);
      }

      .reflection-tone.intense {
        background: rgba(147, 51, 234, 0.15);
        color: rgba(196, 181, 253, 0.9);
      }

      .premium-indicator {
        font-size: clamp(0.55rem, 1.3vw, 0.65rem);
        padding: clamp(0.15rem, 0.4vh, 0.2rem) clamp(0.3rem, 0.8vw, 0.5rem);
        border-radius: 8px;
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.2),
          rgba(217, 119, 6, 0.15)
        );
        color: rgba(251, 191, 36, 0.9);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Evolution Card - Compact Insights */
      .evolution-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: clamp(0.6rem, 1.5vh, 1rem);
        min-height: 0;
      }

      .evolution-preview {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: clamp(0.4rem, 1vh, 0.6rem);
        min-height: 0;
      }

      .insight-item {
        display: flex;
        align-items: center;
        gap: clamp(0.6rem, 1.5vw, 0.8rem);
        padding: clamp(0.5rem, 1.2vh, 0.7rem);
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: clamp(8px, 1.6vw, 10px);
        transition: all 0.3s ease;
      }

      .insight-item.locked {
        opacity: 0.5;
      }

      .insight-item:not(.locked):hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.1);
      }

      .insight-icon {
        font-size: clamp(1rem, 2.5vw, 1.2rem);
        width: clamp(28px, 6vw, 32px);
        height: clamp(28px, 6vw, 32px);
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.06);
        border-radius: clamp(6px, 1.2vw, 8px);
        flex-shrink: 0;
      }

      .insight-text {
        flex: 1;
        min-width: 0;
      }

      .insight-title {
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        font-weight: 400;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: clamp(0.1rem, 0.3vh, 0.2rem);
        line-height: 1.2;
      }

      .insight-value {
        font-size: clamp(0.8rem, 2vw, 0.95rem);
        font-weight: 500;
        color: rgba(255, 255, 255, 0.95);
        line-height: 1.2;
      }

      .unlock-message {
        font-size: clamp(0.65rem, 1.6vw, 0.75rem) !important;
        font-weight: 300 !important;
        color: rgba(255, 255, 255, 0.6) !important;
        font-style: italic;
      }

      .required-count {
        color: rgba(16, 185, 129, 0.8);
        font-weight: 400;
      }

      .evolution-actions {
        text-align: center;
        flex-shrink: 0;
      }

      .evolution-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: clamp(0.5rem, 1.2vh, 0.7rem) clamp(0.8rem, 2vw, 1.2rem);
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.12),
          rgba(5, 150, 105, 0.08)
        );
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 10px;
        color: rgba(110, 231, 183, 0.9);
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .evolution-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.18),
          rgba(5, 150, 105, 0.12)
        );
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.15);
      }

      /* Subscription Card - Compact Tier Display */
      .subscription-status {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: clamp(0.8rem, 2vh, 1.2rem);
        min-height: 0;
      }

      .tier-display {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        gap: clamp(0.5rem, 1.2vh, 0.8rem);
      }

      .tier-badge {
        display: inline-block;
        padding: clamp(0.4rem, 1vh, 0.6rem) clamp(0.8rem, 2vw, 1.2rem);
        border-radius: clamp(12px, 2.4vw, 16px);
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        font-weight: 500;
        margin-bottom: clamp(0.4rem, 1vh, 0.6rem);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        align-self: center;
      }

      .tier-badge.free {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
      }

      .tier-badge.essential {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.2),
          rgba(5, 150, 105, 0.15)
        );
        color: rgba(110, 231, 183, 0.9);
      }

      .tier-badge.premium {
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.2),
          rgba(217, 119, 6, 0.15)
        );
        color: rgba(251, 191, 36, 0.9);
      }

      .tier-badge.creator {
        background: linear-gradient(
          135deg,
          rgba(147, 51, 234, 0.2),
          rgba(99, 102, 241, 0.15)
        );
        color: rgba(196, 181, 253, 0.9);
      }

      .tier-description {
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.4;
        text-align: center;
      }

      .subscription-actions {
        text-align: center;
        flex-shrink: 0;
      }

      .subscription-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: clamp(0.6rem, 1.5vh, 0.8rem) clamp(1rem, 2.5vw, 1.4rem);
        border: none;
        border-radius: clamp(10px, 2vw, 12px);
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        font-weight: 400;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .subscription-btn.upgrade-subscription {
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.2),
          rgba(217, 119, 6, 0.15)
        );
        border: 1px solid rgba(245, 158, 11, 0.3);
        color: rgba(251, 191, 36, 0.9);
      }

      .subscription-btn.upgrade-subscription:hover {
        background: linear-gradient(
          135deg,
          rgba(245, 158, 11, 0.3),
          rgba(217, 119, 6, 0.2)
        );
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.15);
      }

      /* Loading States - Cosmic Theme */
      .loading-reflections {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: clamp(0.8rem, 2vh, 1.2rem);
        color: rgba(255, 255, 255, 0.6);
        text-align: center;
        padding: clamp(1rem, 2.5vh, 1.5rem);
      }

      .cosmic-spinner {
        width: clamp(30px, 6vw, 40px);
        height: clamp(30px, 6vw, 40px);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top-color: rgba(147, 51, 234, 0.7);
        border-right-color: rgba(59, 130, 246, 0.5);
        animation: cosmicSpin 1.5s linear infinite;
        position: relative;
      }

      @keyframes cosmicSpin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .cosmic-spinner::after {
        content: "";
        position: absolute;
        inset: 6px;
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 50%;
        border-left-color: transparent;
        border-bottom-color: transparent;
        animation: cosmicSpin 2s linear infinite reverse;
      }

      /* Empty States */
      .empty-state {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: clamp(1rem, 2.5vh, 1.5rem);
        color: rgba(255, 255, 255, 0.7);
        gap: clamp(0.6rem, 1.5vh, 1rem);
      }

      .empty-icon {
        font-size: clamp(2rem, 5vw, 2.5rem);
        opacity: 0.6;
        animation: emptyFloat 3s ease-in-out infinite;
      }

      @keyframes emptyFloat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      .empty-state h4 {
        font-size: clamp(0.9rem, 2.2vw, 1.1rem);
        font-weight: 400;
        margin: 0;
        color: rgba(255, 255, 255, 0.9);
      }

      .empty-state p {
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        margin: 0;
        line-height: 1.4;
        color: rgba(255, 255, 255, 0.6);
      }

      .empty-action {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: clamp(0.5rem, 1.2vh, 0.7rem) clamp(0.8rem, 2vw, 1.2rem);
        background: linear-gradient(
          135deg,
          rgba(147, 51, 234, 0.12),
          rgba(99, 102, 241, 0.08)
        );
        border: 1px solid rgba(147, 51, 234, 0.2);
        border-radius: 10px;
        color: rgba(196, 181, 253, 0.9);
        font-size: clamp(0.7rem, 1.7vw, 0.8rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .empty-action:hover {
        background: linear-gradient(
          135deg,
          rgba(147, 51, 234, 0.18),
          rgba(99, 102, 241, 0.12)
        );
        transform: translateY(-1px);
      }

      /* Loading Overlay - Cosmic Theme */
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(15, 15, 35, 0.9);
        backdrop-filter: blur(20px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .loading-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .loading-content {
        text-align: center;
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: clamp(1rem, 2.5vh, 1.5rem);
      }

      .cosmic-loader {
        width: clamp(60px, 12vw, 80px);
        height: clamp(60px, 12vw, 80px);
        position: relative;
      }

      .cosmic-loader::before {
        content: "";
        position: absolute;
        inset: 0;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top-color: rgba(147, 51, 234, 0.8);
        border-right-color: rgba(59, 130, 246, 0.6);
        animation: cosmicSpin 1.5s linear infinite;
      }

      .cosmic-loader::after {
        content: "";
        position: absolute;
        inset: 12px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-left-color: rgba(16, 185, 129, 0.7);
        border-bottom-color: rgba(245, 158, 11, 0.5);
        animation: cosmicSpin 2s linear infinite reverse;
      }

      .loading-text {
        font-size: clamp(0.9rem, 2.2vw, 1.1rem);
        font-weight: 300;
        color: rgba(255, 255, 255, 0.8);
        letter-spacing: 0.5px;
      }

      /* Toast Notifications - Cosmic Theme */
      .toast-container {
        position: fixed;
        top: clamp(80px, 12vh, 100px);
        right: clamp(1rem, 3vw, 2rem);
        z-index: 1001;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        max-width: clamp(280px, 40vw, 400px);
      }

      .toast {
        padding: clamp(0.8rem, 2vh, 1.2rem) clamp(1rem, 2.5vw, 1.5rem);
        background: rgba(15, 15, 35, 0.95);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(12px, 2.4vw, 16px);
        color: rgba(255, 255, 255, 0.9);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.3s ease;
        animation: toastSlide 0.3s ease-out forwards;
        font-size: clamp(0.8rem, 1.9vw, 0.9rem);
        line-height: 1.4;
      }

      @keyframes toastSlide {
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .toast.success {
        border-color: rgba(16, 185, 129, 0.3);
        background: linear-gradient(
          135deg,
          rgba(15, 15, 35, 0.95) 0%,
          rgba(16, 185, 129, 0.08) 100%
        );
      }

      .toast.error {
        border-color: rgba(239, 68, 68, 0.3);
        background: linear-gradient(
          135deg,
          rgba(15, 15, 35, 0.95) 0%,
          rgba(239, 68, 68, 0.08) 100%
        );
      }

      .toast.warning {
        border-color: rgba(245, 158, 11, 0.3);
        background: linear-gradient(
          135deg,
          rgba(15, 15, 35, 0.95) 0%,
          rgba(245, 158, 11, 0.08) 100%
        );
      }

      /* Mobile Responsive - Optimized Experience */
      @media (max-width: 1024px) {
        .dashboard-grid {
          grid-template-columns: 1fr;
          grid-template-rows: repeat(4, minmax(200px, 1fr));
        }

        .nav-links {
          display: none;
        }
      }

      @media (max-width: 768px) {
        html,
        body {
          overflow-y: auto;
          height: auto;
          min-height: 100vh;
          position: static;
        }

        .nav-bar {
          position: sticky;
          height: clamp(50px, 7vh, 60px);
        }

        .nav-left .logo .logo-text {
          display: none;
        }

        .dashboard-main {
          height: auto;
          min-height: calc(100vh - clamp(50px, 7vh, 60px));
          padding-top: 0;
        }

        .dashboard-container {
          padding: clamp(0.8rem, 2vh, 1.2rem);
          gap: clamp(0.8rem, 2vh, 1.2rem);
        }

        .welcome-section {
          flex-direction: column;
          gap: clamp(1rem, 2.5vh, 1.5rem);
          text-align: center;
          padding: clamp(1.2rem, 3vh, 1.8rem);
        }

        .quick-actions {
          flex-direction: column;
          width: 100%;
          gap: clamp(0.6rem, 1.5vh, 0.8rem);
        }

        .action-btn {
          width: 100%;
          justify-content: center;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
          grid-template-rows: none;
          grid-auto-rows: minmax(220px, auto);
        }

        .usage-display {
          flex-direction: column;
          text-align: center;
          gap: clamp(0.8rem, 2vh, 1.2rem);
        }

        .usage-stats {
          align-items: center;
        }

        .stat-row {
          justify-content: center;
          gap: clamp(0.5rem, 1.2vw, 0.8rem);
        }

        .user-dropdown {
          min-width: 180px;
          right: -0.5rem;
        }

        .toast-container {
          right: 0.5rem;
          left: 0.5rem;
          max-width: none;
        }
      }

      @media (max-width: 480px) {
        .dashboard-container {
          padding: clamp(0.6rem, 1.5vh, 1rem);
        }

        .nav-bar {
          padding: 0 clamp(0.8rem, 2vw, 1.2rem);
        }

        .welcome-section {
          padding: clamp(1rem, 2.5vh, 1.4rem);
        }

        .dashboard-card {
          padding: clamp(0.8rem, 2vh, 1.2rem);
        }

        .reflections-list {
          gap: clamp(0.4rem, 1vh, 0.6rem);
        }

        .reflection-item {
          padding: clamp(0.5rem, 1.2vh, 0.7rem);
        }

        .nav-right .upgrade-btn span:last-child {
          display: none;
        }

        .user-btn .user-name {
          display: none;
        }
      }

      /* Ultra compact for very small screens */
      @media (max-width: 360px) {
        .dashboard-card {
          border-radius: 14px;
          padding: clamp(0.7rem, 1.8vh, 1rem);
        }

        .card-header {
          margin-bottom: clamp(0.6rem, 1.5vh, 0.8rem);
        }

        .insight-item,
        .reflection-item {
          padding: clamp(0.4rem, 1vh, 0.6rem);
        }
      }

      /* Landscape mobile optimization */
      @media (max-height: 500px) and (orientation: landscape) {
        .welcome-section {
          padding: clamp(0.8rem, 2vh, 1.2rem);
        }

        .dashboard-grid {
          grid-auto-rows: minmax(180px, auto);
        }

        .dashboard-card {
          padding: clamp(0.6rem, 1.5vh, 0.9rem);
        }
      }

      /* Accessibility improvements */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }

        .cosmic-mirror,
        .cosmic-particle,
        .cosmic-spinner,
        .cosmic-loader,
        .progress-circle {
          animation: none !important;
        }
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        .dashboard-card,
        .nav-bar,
        .welcome-section {
          border-color: rgba(255, 255, 255, 0.3);
        }

        .card-title,
        .welcome-title,
        .nav-link {
          color: rgba(255, 255, 255, 1);
        }
      }

      /* Focus indicators for keyboard navigation */
      .nav-link:focus-visible,
      .action-btn:focus-visible,
      .usage-btn:focus-visible,
      .evolution-btn:focus-visible,
      .subscription-btn:focus-visible,
      .user-btn:focus-visible,
      .dropdown-item:focus-visible {
        outline: 2px solid rgba(147, 51, 234, 0.6);
        outline-offset: 2px;
      }

      /* Remove default focus outlines */
      * {
        outline: none !important;
        -webkit-tap-highlight-color: transparent;
      }

      /* iOS specific safe area handling */
      @supports (-webkit-touch-callout: none) {
        .nav-bar {
          padding-top: max(0px, env(safe-area-inset-top));
        }

        .dashboard-container {
          padding-left: max(clamp(1rem, 3vw, 2rem), env(safe-area-inset-left));
          padding-right: max(
            clamp(1rem, 3vw, 2rem),
            env(safe-area-inset-right)
          );
          padding-bottom: max(
            clamp(0.8rem, 2vh, 1.5rem),
            env(safe-area-inset-bottom)
          );
        }

        .toast-container {
          right: max(clamp(1rem, 3vw, 2rem), env(safe-area-inset-right));
        }
      }
    </style>
  </head>

  <body>
    <!-- Cosmic Mirror Shards -->
    <div class="cosmic-mirrors">
      <div class="cosmic-mirror"></div>
      <div class="cosmic-mirror"></div>
      <div class="cosmic-mirror"></div>
      <div class="cosmic-mirror"></div>
      <div class="cosmic-mirror"></div>
      <div class="cosmic-mirror"></div>
    </div>

    <!-- Floating Particles -->
    <div class="cosmic-particles">
      <div class="cosmic-particle"></div>
      <div class="cosmic-particle"></div>
      <div class="cosmic-particle"></div>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
      <div class="nav-left">
        <a href="/" class="logo">
          <span class="mirror-logo">ü™û</span>
          <span class="logo-text">Mirror of Truth</span>
        </a>

        <div class="nav-links">
          <a href="/dashboard" class="nav-link active">
            <span>üè†</span>
            <span>Journey</span>
          </a>
          <a href="/reflection" class="nav-link reflect-nav">
            <span>‚ú®</span>
            <span>Reflect</span>
          </a>
          <a href="/admin" class="nav-link admin-only" style="display: none">
            <span>‚ö°</span>
            <span>Admin</span>
          </a>
        </div>
      </div>

      <div class="nav-right">
        <a
          href="/subscription"
          class="upgrade-btn tier-upgrade"
          style="display: none"
        >
          <span>üíé</span>
          <span>Upgrade</span>
        </a>

        <div class="user-menu" id="userMenu">
          <button class="user-btn" id="userBtn">
            <span class="user-avatar" id="userAvatar">üë§</span>
            <span class="user-name" id="userName">Loading...</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>

          <div class="user-dropdown" id="userDropdown">
            <a href="/profile" class="dropdown-item">
              <span>üë§</span>
              <span>Profile</span>
            </a>
            <a href="/reflections" class="dropdown-item">
              <span>üìö</span>
              <span>All Reflections</span>
            </a>
            <a
              href="/evolution"
              class="dropdown-item evolution-only"
              style="display: none"
            >
              <span>üå±</span>
              <span>Evolution Reports</span>
            </a>
            <a href="/subscription" class="dropdown-item subscription-only">
              <span>üí≥</span>
              <span>Subscription</span>
            </a>
            <div
              style="
                height: 1px;
                background: rgba(255, 255, 255, 0.1);
                margin: 0.5rem 0;
              "
            ></div>
            <button class="dropdown-item" onclick="handleSignOut()">
              <span>üö™</span>
              <span>Sign Out</span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Dashboard -->
    <main class="dashboard-main">
      <div class="dashboard-container">
        <!-- Welcome Section -->
        <section class="welcome-section">
          <div class="welcome-content">
            <h1 class="welcome-title">
              <span class="greeting" id="welcomeGreeting">Welcome back,</span>
              <span class="user-name-display" id="welcomeName"
                >Sacred Soul</span
              >
            </h1>
            <p class="welcome-subtitle" id="welcomeMessage">
              Your journey of self-discovery continues...
            </p>
          </div>

          <div class="quick-actions">
            <a href="/reflection" class="action-btn primary" id="reflectBtn">
              <span>‚ú®</span>
              <span id="reflectBtnText">Reflect Now</span>
            </a>
            <a href="/gifting" class="action-btn secondary">
              <span>üéÅ</span>
              <span>Gift Reflection</span>
            </a>
          </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
          <!-- Usage Overview Card -->
          <div class="dashboard-card usage-card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üìä</span>
                <span>This Month</span>
              </h3>
            </div>

            <div class="card-content">
              <div class="usage-display">
                <div class="usage-chart">
                  <div class="progress-circle" id="usageProgress">
                    <div class="progress-value" id="usagePercentage">0%</div>
                  </div>
                </div>

                <div class="usage-stats">
                  <div class="stat-row">
                    <span class="stat-label">Reflections</span>
                    <span class="stat-value" id="currentCount">0</span>
                  </div>
                  <div class="stat-row">
                    <span class="stat-label">Monthly Limit</span>
                    <span class="stat-value" id="monthlyLimit">‚àû</span>
                  </div>
                  <div class="stat-row">
                    <span class="stat-label">Total Created</span>
                    <span class="stat-value" id="totalReflections">0</span>
                  </div>
                </div>
              </div>

              <div class="usage-actions">
                <a href="/reflections" class="usage-btn" id="usageActionBtn">
                  <span>üìö</span>
                  <span>View All</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Recent Reflections Card -->
          <div class="dashboard-card reflections-card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üåô</span>
                <span>Recent Reflections</span>
              </h3>
              <a href="/reflections" class="header-action">
                <span>View All</span>
                <span>‚Üí</span>
              </a>
            </div>

            <div class="card-content">
              <div class="reflections-list" id="recentReflectionsList">
                <div class="loading-reflections">
                  <div class="cosmic-spinner"></div>
                  <span>Loading your journey...</span>
                </div>
              </div>

              <div
                class="empty-state"
                id="emptyReflections"
                style="display: none"
              >
                <div class="empty-icon">ü™û</div>
                <h4>Your Journey Awaits</h4>
                <p>
                  Create your first reflection to begin seeing yourself clearly.
                </p>
                <a href="/reflection" class="empty-action">
                  <span>‚ú®</span>
                  <span>Start Reflecting</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Evolution Insights Card -->
          <div class="dashboard-card evolution-card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">ü¶ã</span>
                <span>Evolution Insights</span>
              </h3>
            </div>

            <div class="card-content">
              <div class="evolution-content">
                <div class="evolution-preview">
                  <div class="insight-item">
                    <div class="insight-icon">üìà</div>
                    <div class="insight-text">
                      <div class="insight-title">Total Journey</div>
                      <div class="insight-value" id="totalReflectionsCount">
                        0 reflections
                      </div>
                    </div>
                  </div>

                  <div class="insight-item locked" id="patternsInsight">
                    <div class="insight-icon">üåä</div>
                    <div class="insight-text">
                      <div class="insight-title">Growth Patterns</div>
                      <div class="insight-value unlock-message">
                        <span class="required-count">3</span> more needed
                      </div>
                    </div>
                  </div>

                  <div class="insight-item locked" id="evolutionReportInsight">
                    <div class="insight-icon">ü¶ã</div>
                    <div class="insight-text">
                      <div class="insight-title">Evolution Report</div>
                      <div class="insight-value unlock-message">
                        Upgrade to Essential+
                      </div>
                    </div>
                  </div>
                </div>

                <div class="evolution-actions">
                  <a
                    href="/register"
                    class="evolution-btn"
                    id="evolutionActionBtn"
                  >
                    <span>üíé</span>
                    <span>Unlock Evolution Reports</span>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Subscription Status Card -->
          <div class="dashboard-card subscription-card">
            <div class="card-header">
              <h3 class="card-title">
                <span class="card-icon">üíé</span>
                <span>Your Plan</span>
              </h3>
            </div>

            <div class="card-content">
              <div class="subscription-status">
                <div class="tier-display">
                  <div class="tier-badge" id="tierBadge">Free</div>
                  <div class="tier-description" id="tierDescription">
                    1 reflection per month to explore your consciousness
                  </div>
                </div>

                <div class="subscription-actions">
                  <a
                    href="/register"
                    class="subscription-btn upgrade-subscription"
                    id="subscriptionActionBtn"
                  >
                    <span>‚ú®</span>
                    <span>Upgrade Journey</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="cosmic-loader"></div>
        <div class="loading-text" id="loadingText">
          Preparing your sacred space...
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
      // Mesmerizing Dashboard Logic - Perfect Contained Experience
      let userData = null;
      let usageData = null;
      let recentReflections = [];
      let isLoading = false;

      // Tier limits and thresholds
      const TIER_LIMITS = {
        free: 1,
        essential: 5,
        premium: 10,
        creator: "unlimited",
      };

      const EVOLUTION_THRESHOLDS = {
        essential: 4,
        premium: 6,
      };

      // Initialize dashboard
      window.addEventListener("load", initializeDashboard);

      async function initializeDashboard() {
        try {
          await authenticateAndLoadUser();
          await loadDashboardData();
          setupInteractions();
          startCosmicAnimations();
        } catch (error) {
          console.error("ü™û Dashboard initialization failed:", error);
          handleAuthenticationError();
        }
      }

      // Authentication & User Data
      async function authenticateAndLoadUser() {
        const token = localStorage.getItem("mirror_auth_token");

        if (!token) {
          throw new Error("No authentication token found");
        }

        try {
          const response = await fetch("/api/auth", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ action: "verify-token" }),
          });

          if (!response.ok) {
            throw new Error(`Authentication failed: ${response.status}`);
          }

          const data = await response.json();

          if (!data.success) {
            throw new Error(data.error || "Token verification failed");
          }

          userData = data.user;

          // Update localStorage with fresh data
          const updatedUserData = {
            name: userData.name,
            email: userData.email,
            language: userData.language || "en",
            isCreator: userData.isCreator || false,
            isAdmin: userData.isAdmin || false,
            tier: userData.tier || "free",
            subscriptionStatus: userData.subscriptionStatus || "active",
            reflectionCountThisMonth: userData.reflectionCountThisMonth || 0,
            totalReflections: userData.totalReflections || 0,
          };

          localStorage.setItem(
            "mirrorVerifiedUser",
            JSON.stringify(updatedUserData)
          );

          console.log(
            `ü™û Dashboard loaded for: ${userData.email} (${userData.tier})`
          );

          updateUserInterface();
        } catch (error) {
          console.error("ü™û Authentication error:", error);
          throw error;
        }
      }

      function updateUserInterface() {
        updateNavigation();
        updateWelcomeSection();
        updateUserMenu();
        updateTierSpecificElements();
      }

      function updateNavigation() {
        // Show admin link for creators/admins
        if (userData.isCreator || userData.isAdmin) {
          document.querySelector(".admin-only").style.display = "flex";
        }

        // Show upgrade button for free users
        if (userData.tier === "free") {
          document.querySelector(".tier-upgrade").style.display = "flex";
        }

        // Update reflection link with appropriate mode
        const reflectLink = document.querySelector(".reflect-nav");
        if (userData.isCreator) {
          reflectLink.href = "/reflection?mode=creator";
        } else {
          reflectLink.href = "/reflection";
        }
      }

      function updateWelcomeSection() {
        const greeting = getTimeBasedGreeting();
        const firstName = userData.name.split(" ")[0];

        document.getElementById("welcomeGreeting").textContent = greeting;
        document.getElementById("welcomeName").textContent = firstName;

        // Update welcome message based on tier and usage
        const welcomeMessage = getWelcomeMessage();
        document.getElementById("welcomeMessage").textContent = welcomeMessage;

        // Update reflect button
        const reflectBtn = document.getElementById("reflectBtn");
        const reflectBtnText = document.getElementById("reflectBtnText");

        if (userData.isCreator || userData.isAdmin) {
          reflectBtnText.textContent = "Creator Space";
          reflectBtn.href = "/reflection?mode=creator";
        } else {
          reflectBtnText.textContent = "Reflect Now";
          reflectBtn.href = "/reflection";
        }
      }

      function updateUserMenu() {
        const userName = document.getElementById("userName");
        const userAvatar = document.getElementById("userAvatar");

        // Update display name (first name only for UI)
        const firstName = userData.name.split(" ")[0];
        userName.textContent = firstName;

        // Update avatar based on tier
        if (userData.isCreator) {
          userAvatar.textContent = "üåü";
        } else if (userData.tier === "premium") {
          userAvatar.textContent = "üíé";
        } else if (userData.tier === "essential") {
          userAvatar.textContent = "‚ú®";
        } else {
          userAvatar.textContent = "üë§";
        }

        // Show/hide tier-specific menu items
        if (userData.tier === "free") {
          document
            .querySelectorAll(".evolution-only")
            .forEach((el) => (el.style.display = "none"));
        } else {
          document
            .querySelectorAll(".evolution-only")
            .forEach((el) => (el.style.display = "flex"));
        }
      }

      function updateTierSpecificElements() {
        updateSubscriptionCard();
        updateEvolutionDisplay();
      }

      // Dashboard Data Loading
      async function loadDashboardData() {
        showLoadingState(true, "Loading your sacred journey...");

        try {
          await loadUsageData();
          await loadRecentReflections();
          updateUsageDisplay();
          updateReflectionsDisplay();
          updateEvolutionDisplay();
        } catch (error) {
          console.error("ü™û Failed to load dashboard data:", error);
          showToast(
            "Failed to load dashboard data. Please refresh the page.",
            "error"
          );
        } finally {
          showLoadingState(false);
        }
      }

      async function loadUsageData() {
        try {
          const token = localStorage.getItem("mirror_auth_token");

          const response = await fetch("/api/reflections", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ action: "check-usage" }),
          });

          if (response.ok) {
            const data = await response.json();
            if (data.success) {
              usageData = data.usage;
            }
          }
        } catch (error) {
          console.error("ü™û Failed to load usage data:", error);
          // Use fallback data from userData
          usageData = {
            currentCount: userData.reflectionCountThisMonth,
            limit: userData.isCreator
              ? "unlimited"
              : TIER_LIMITS[userData.tier],
            canReflect: true,
            tier: userData.tier,
            totalReflections: userData.totalReflections,
            percentUsed: 0,
          };
        }
      }

      async function loadRecentReflections() {
        try {
          const token = localStorage.getItem("mirror_auth_token");

          const url = new URL("/api/reflections", window.location.origin);
          url.searchParams.set("action", "get-history");
          url.searchParams.set("limit", "4");

          const response = await fetch(url, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            const data = await response.json();
            if (data.success) {
              recentReflections = data.reflections || [];
            }
          }
        } catch (error) {
          console.error("ü™û Failed to load recent reflections:", error);
          recentReflections = [];
        }
      }

      // Display Updates
      function updateUsageDisplay() {
        const currentCount =
          usageData?.currentCount || userData.reflectionCountThisMonth;
        const limit =
          usageData?.limit ||
          (userData.isCreator ? "unlimited" : TIER_LIMITS[userData.tier]);
        const totalReflections = userData.totalReflections || 0;

        // Update usage numbers
        document.getElementById("currentCount").textContent = currentCount;
        document.getElementById("monthlyLimit").textContent =
          limit === "unlimited" ? "‚àû" : limit;
        document.getElementById("totalReflections").textContent =
          totalReflections;

        // Update progress circle
        let percentage = 0;
        if (limit !== "unlimited" && limit > 0) {
          percentage = Math.min((currentCount / limit) * 100, 100);
        }

        document.getElementById("usagePercentage").textContent = `${Math.round(
          percentage
        )}%`;

        // Update CSS custom property for progress circle
        const progressCircle = document.getElementById("usageProgress");
        if (progressCircle) {
          progressCircle.style.setProperty("--progress", `${percentage}%`);
        }

        // Update usage action button
        const usageActionBtn = document.getElementById("usageActionBtn");
        if (currentCount === 0) {
          usageActionBtn.innerHTML =
            "<span>‚ú®</span><span>Start Journey</span>";
          usageActionBtn.href = "/reflection";
        } else {
          usageActionBtn.innerHTML = "<span>üìö</span><span>View All</span>";
          usageActionBtn.href = "/reflections";
        }
      }

      function updateReflectionsDisplay() {
        const reflectionsList = document.getElementById(
          "recentReflectionsList"
        );
        const emptyState = document.getElementById("emptyReflections");

        if (recentReflections.length === 0) {
          reflectionsList.style.display = "none";
          emptyState.style.display = "flex";
        } else {
          reflectionsList.style.display = "flex";
          emptyState.style.display = "none";

          // Clear loading state
          reflectionsList.innerHTML = "";

          // Add reflections
          recentReflections.forEach((reflection, index) => {
            const reflectionElement = createReflectionElement(reflection);
            reflectionElement.style.animationDelay = `${index * 0.1}s`;
            reflectionsList.appendChild(reflectionElement);
          });
        }
      }

      function createReflectionElement(reflection) {
        const element = document.createElement("div");
        element.className = "reflection-item";
        element.onclick = () => viewReflection(reflection.id);

        const timeAgo =
          reflection.timeAgo || formatTimeAgo(reflection.createdAt);
        const preview = reflection.dream
          ? reflection.dream.substring(0, 80)
          : "Reflection content...";

        element.innerHTML = `
          <div class="reflection-header">
            <div class="reflection-title">${
              reflection.title || "Sacred Reflection"
            }</div>
            <div class="reflection-date">${timeAgo}</div>
          </div>
          <div class="reflection-preview">${preview}${
          preview.length > 80 ? "..." : ""
        }</div>
          <div class="reflection-meta">
            <div class="reflection-tone ${
              reflection.tone || "fusion"
            }">${formatToneName(reflection.tone)}</div>
            ${
              reflection.isPremium
                ? '<div class="premium-indicator">Premium</div>'
                : ""
            }
          </div>
        `;

        return element;
      }

      function updateEvolutionDisplay() {
        const totalReflections = userData.totalReflections || 0;
        const evolutionActionBtn =
          document.getElementById("evolutionActionBtn");

        // Update total reflections count
        document.getElementById("totalReflectionsCount").textContent =
          totalReflections === 0
            ? "Begin your journey"
            : totalReflections === 1
            ? "1 reflection"
            : `${totalReflections} reflections`;

        // Check evolution eligibility
        const canGenerateReport =
          userData.tier !== "free" &&
          totalReflections >= EVOLUTION_THRESHOLDS[userData.tier];

        // Update patterns insight
        const patternsInsight = document.getElementById("patternsInsight");
        if (totalReflections >= 3) {
          patternsInsight.classList.remove("locked");
          patternsInsight.querySelector(".insight-value").textContent =
            "Available";
          patternsInsight.querySelector(".insight-value").className =
            "insight-value";
        } else {
          const needed = 3 - totalReflections;
          patternsInsight.querySelector(".required-count").textContent = needed;
        }

        // Update evolution report insight
        const evolutionReportInsight = document.getElementById(
          "evolutionReportInsight"
        );
        if (userData.tier === "free") {
          evolutionReportInsight.querySelector(".insight-value").textContent =
            "Upgrade to Essential+";
        } else if (canGenerateReport) {
          evolutionReportInsight.classList.remove("locked");
          evolutionReportInsight.querySelector(".insight-value").textContent =
            "Ready to Generate";
          evolutionReportInsight.querySelector(".insight-value").className =
            "insight-value";
        } else {
          const needed = EVOLUTION_THRESHOLDS[userData.tier] - totalReflections;
          evolutionReportInsight.querySelector(
            ".insight-value"
          ).textContent = `${needed} more reflection${
            needed === 1 ? "" : "s"
          } needed`;
        }

        // Update action button
        if (userData.tier === "free") {
          evolutionActionBtn.innerHTML =
            "<span>üíé</span><span>Unlock Evolution Reports</span>";
          evolutionActionBtn.href = "/register";
        } else if (canGenerateReport) {
          evolutionActionBtn.innerHTML =
            "<span>ü¶ã</span><span>Generate Report</span>";
          evolutionActionBtn.onclick = generateEvolutionReport;
          evolutionActionBtn.removeAttribute("href");
        } else {
          const needed = EVOLUTION_THRESHOLDS[userData.tier] - totalReflections;
          evolutionActionBtn.innerHTML = `<span>‚ú®</span><span>Create ${needed} More</span>`;
          evolutionActionBtn.href = "/reflection";
          evolutionActionBtn.onclick = null;
        }
      }

      function updateSubscriptionCard() {
        const tierBadge = document.getElementById("tierBadge");
        const tierDescription = document.getElementById("tierDescription");
        const subscriptionActionBtn = document.getElementById(
          "subscriptionActionBtn"
        );

        // Update tier display
        tierBadge.textContent =
          userData.tier.charAt(0).toUpperCase() + userData.tier.slice(1);
        tierBadge.className = `tier-badge ${userData.tier}`;

        // Update description based on tier
        const descriptions = {
          free: "1 reflection per month to explore your consciousness",
          essential:
            "5 reflections monthly + Evolution Reports to track growth",
          premium: "10 reflections monthly + Advanced Evolution Insights",
          creator: "Unlimited reflections and full access to all features",
        };

        tierDescription.textContent =
          descriptions[userData.tier] || descriptions.free;

        // Update action button
        if (userData.tier === "free") {
          subscriptionActionBtn.innerHTML =
            "<span>‚ú®</span><span>Upgrade Journey</span>";
          subscriptionActionBtn.href = "/register";
        } else if (userData.tier === "essential") {
          subscriptionActionBtn.innerHTML =
            "<span>üíé</span><span>Unlock Premium</span>";
          subscriptionActionBtn.href = "/register?tier=premium";
        } else {
          subscriptionActionBtn.innerHTML =
            "<span>‚öôÔ∏è</span><span>Manage Plan</span>";
          subscriptionActionBtn.href = "/subscription";
        }
      }

      // Interaction Handlers
      function setupInteractions() {
        setupUserMenu();
        setupKeyboardShortcuts();

        // Mobile touch interactions
        if ("ontouchstart" in window) {
          addTouchInteractions();
        }
      }

      function setupUserMenu() {
        const userBtn = document.getElementById("userBtn");
        const userDropdown = document.getElementById("userDropdown");
        const userMenu = document.getElementById("userMenu");

        userBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          userMenu.classList.toggle("open");
          userDropdown.classList.toggle("show");
        });

        // Close menu when clicking outside
        document.addEventListener("click", function (e) {
          if (!userMenu.contains(e.target)) {
            userMenu.classList.remove("open");
            userDropdown.classList.remove("show");
          }
        });

        // Close menu on escape key
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            userMenu.classList.remove("open");
            userDropdown.classList.remove("show");
          }
        });
      }

      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", function (e) {
          // Cmd/Ctrl + R for new reflection
          if ((e.metaKey || e.ctrlKey) && e.key === "r") {
            e.preventDefault();
            window.location.href = userData.isCreator
              ? "/reflection?mode=creator"
              : "/reflection";
          }

          // Cmd/Ctrl + G for gift
          if ((e.metaKey || e.ctrlKey) && e.key === "g") {
            e.preventDefault();
            window.location.href = "/gifting";
          }
        });
      }

      // Action Functions
      function viewReflection(reflectionId) {
        window.location.href = `/reflections/view?id=${reflectionId}`;
      }

      async function generateEvolutionReport() {
        if (isLoading) return;

        setLoadingState(true, "Generating your evolution report...");

        try {
          const token = localStorage.getItem("mirror_auth_token");

          const response = await fetch("/api/evolution", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ action: "generate-report" }),
          });

          const data = await response.json();

          if (data.success) {
            showToast("Evolution report generated successfully!", "success");
            setTimeout(() => {
              window.location.href = `/evolution?report=${data.report.id}`;
            }, 1500);
          } else {
            throw new Error(
              data.error || "Failed to generate evolution report"
            );
          }
        } catch (error) {
          console.error("ü™û Evolution report error:", error);
          showToast(
            "Failed to generate evolution report. Please try again.",
            "error"
          );
        } finally {
          setLoadingState(false);
        }
      }

      async function handleSignOut() {
        if (confirm("Are you sure you want to sign out?")) {
          try {
            const token = localStorage.getItem("mirror_auth_token");

            // Call signout API
            await fetch("/api/auth", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ action: "signout" }),
            });
          } catch (error) {
            console.error("ü™û Signout error:", error);
          } finally {
            // Clear local storage
            localStorage.removeItem("mirror_auth_token");
            localStorage.removeItem("mirrorVerifiedUser");

            // Redirect to portal
            window.location.href = "/";
          }
        }
      }

      // Utility Functions
      function getTimeBasedGreeting() {
        const hour = new Date().getHours();

        if (hour < 6) return "Deep night greetings,";
        if (hour < 12) return "Good morning,";
        if (hour < 17) return "Good afternoon,";
        if (hour < 21) return "Good evening,";
        return "Late night wisdom,";
      }

      function getWelcomeMessage() {
        const messages = {
          free: "Your journey of self-discovery awaits...",
          essential: "Continue exploring your inner landscape...",
          premium: "Dive deeper into your consciousness evolution...",
          creator: "Welcome to your sacred creative space...",
        };

        return messages[userData.tier] || messages.free;
      }

      function formatTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffMins < 1) return "just now";
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        if (diffDays < 7) return `${diffDays}d ago`;

        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
          year: diffDays > 365 ? "numeric" : undefined,
        });
      }

      function formatToneName(tone) {
        const toneNames = {
          gentle: "Gentle",
          intense: "Intense",
          fusion: "Fusion",
        };
        return toneNames[tone] || "Fusion";
      }

      // Loading & Error States
      function showLoadingState(show, message = "Loading...") {
        const overlay = document.getElementById("loadingOverlay");
        const loadingText = document.getElementById("loadingText");

        if (show) {
          loadingText.textContent = message;
          overlay.style.display = "flex";
          requestAnimationFrame(() => overlay.classList.add("show"));
        } else {
          overlay.classList.remove("show");
          setTimeout(() => (overlay.style.display = "none"), 300);
        }
      }

      function setLoadingState(loading, message = null) {
        isLoading = loading;
        if (message) {
          showLoadingState(loading, message);
        }
      }

      function handleAuthenticationError() {
        showToast("Authentication failed. Please sign in again.", "error");

        setTimeout(() => {
          localStorage.removeItem("mirror_auth_token");
          localStorage.removeItem("mirrorVerifiedUser");
          window.location.href = "/auth/signin";
        }, 2000);
      }

      // Toast Notifications
      function showToast(message, type = "info", duration = 5000) {
        const container = document.getElementById("toastContainer");

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;

        container.appendChild(toast);

        // Remove toast after duration
        setTimeout(() => {
          toast.style.transform = "translateX(100%)";
          toast.style.opacity = "0";

          setTimeout(() => {
            if (container.contains(toast)) {
              container.removeChild(toast);
            }
          }, 300);
        }, duration);
      }

      // Mobile Interactions
      function addTouchInteractions() {
        document
          .querySelectorAll(".dashboard-card, .action-btn, .nav-link")
          .forEach((element) => {
            element.addEventListener("touchstart", function () {
              this.style.transform = "scale(0.98)";
            });

            element.addEventListener("touchend", function () {
              this.style.transform = "";
            });
          });
      }

      // Cosmic Animations
      function startCosmicAnimations() {
        // Enhanced mirror interactions on hover (desktop only)
        if (window.matchMedia("(hover: hover)").matches) {
          const mirrors = document.querySelectorAll(".cosmic-mirror");

          mirrors.forEach((mirror) => {
            mirror.addEventListener("mouseenter", function () {
              this.style.transform = "scale(1.2) rotate(15deg)";
              this.style.opacity = "0.8";
            });

            mirror.addEventListener("mouseleave", function () {
              this.style.transform = "";
              this.style.opacity = "";
            });
          });
        }

        // Add random sparkle effects
        setInterval(createSparkle, 3000);
      }

      function createSparkle() {
        const sparkle = document.createElement("div");
        sparkle.style.position = "fixed";
        sparkle.style.width = "4px";
        sparkle.style.height = "4px";
        sparkle.style.background = "rgba(255, 255, 255, 0.8)";
        sparkle.style.borderRadius = "50%";
        sparkle.style.pointerEvents = "none";
        sparkle.style.zIndex = "3";
        sparkle.style.left = Math.random() * window.innerWidth + "px";
        sparkle.style.top = Math.random() * window.innerHeight + "px";

        document.body.appendChild(sparkle);

        sparkle.animate(
          [
            { opacity: 0, transform: "scale(0)" },
            { opacity: 1, transform: "scale(1)" },
            { opacity: 0, transform: "scale(0)" },
          ],
          {
            duration: 2000,
            easing: "ease-out",
          }
        ).onfinish = () => {
          if (document.body.contains(sparkle)) {
            document.body.removeChild(sparkle);
          }
        };
      }

      // Debug (Development Only)
      if (window.location.hostname === "localhost") {
        console.log("ü™û Mesmerizing Dashboard - Perfect Contained Experience");

        window.dashboardDebug = {
          userData: () => userData,
          usageData: () => usageData,
          recentReflections: () => recentReflections,
          refreshData: loadDashboardData,
          testToast: (message, type) => showToast(message, type),
        };
      }
    </script>
  </body>
</html>
