<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <title>
      Gift Mirror of Truth Access | Self-Discovery for Someone You Care About
    </title>
    <style>
      /* Perfect No-Scroll 3-Page Gifting Experience */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100vh;
        overflow: hidden;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 25%,
          #16213e 50%,
          #0f0f23 100%
        );
        color: #fff;
        font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
        position: fixed;
        width: 100vw;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Cosmic background */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(
            circle at 20% 30%,
            rgba(59, 130, 246, 0.04) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(16, 185, 129, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 50% 50%,
            rgba(147, 51, 234, 0.02) 0%,
            transparent 50%
          );
        z-index: 1;
        animation: gentleShift 45s ease-in-out infinite;
      }

      @keyframes gentleShift {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 0.7;
        }
        33% {
          transform: scale(1.05) rotate(120deg);
          opacity: 0.9;
        }
        66% {
          transform: scale(0.95) rotate(240deg);
          opacity: 0.6;
        }
      }

      /* Floating particles */
      .floating-particles {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 2;
      }

      .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(251, 191, 36, 0.4);
        border-radius: 50%;
        animation: gentleFloat 25s linear infinite;
      }

      .particle:nth-child(1) {
        left: 10%;
        animation-delay: 0s;
      }
      .particle:nth-child(2) {
        left: 25%;
        animation-delay: 5s;
        background: rgba(16, 185, 129, 0.3);
      }
      .particle:nth-child(3) {
        left: 50%;
        animation-delay: 10s;
        background: rgba(147, 51, 234, 0.3);
      }
      .particle:nth-child(4) {
        left: 75%;
        animation-delay: 15s;
        background: rgba(59, 130, 246, 0.3);
      }
      .particle:nth-child(5) {
        left: 90%;
        animation-delay: 20s;
      }

      @keyframes gentleFloat {
        0% {
          transform: translateY(100vh) scale(0.5);
          opacity: 0;
        }
        10% {
          opacity: 0.8;
        }
        90% {
          opacity: 0.3;
        }
        100% {
          transform: translateY(-10vh) scale(1);
          opacity: 0;
        }
      }

      /* Top Navigation */
      .back-link {
        position: fixed;
        top: clamp(1rem, 2vh, 1.5rem);
        left: clamp(1rem, 2vw, 1.5rem);
        z-index: 100;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        padding: clamp(0.6rem, 1.2vh, 0.8rem) clamp(1rem, 1.8vw, 1.2rem);
        border-radius: 50px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
        font-weight: 300;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        white-space: nowrap;
      }

      .back-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-2px);
      }

      /* Bottom Navigation */
      .page-navigation {
        position: fixed;
        bottom: clamp(1.5rem, 3vh, 2rem);
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: clamp(1rem, 2vw, 1.5rem);
        z-index: 100;
        height: clamp(50px, 8vh, 60px);
      }

      .nav-button {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        padding: clamp(0.8rem, 1.5vh, 1rem) clamp(1.5rem, 3vw, 2rem);
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 50px;
        color: rgba(255, 255, 255, 0.9);
        font-size: clamp(0.85rem, 1.7vw, 0.95rem);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        white-space: nowrap;
        text-decoration: none;
        border: none;
      }

      .nav-button:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }

      .nav-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .nav-button.primary {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.15) 0%,
          rgba(5, 150, 105, 0.1) 100%
        );
        border-color: rgba(16, 185, 129, 0.3);
        color: rgba(255, 255, 255, 0.95);
      }

      .nav-button.primary:hover:not(:disabled) {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.2) 0%,
          rgba(5, 150, 105, 0.15) 100%
        );
        border-color: rgba(16, 185, 129, 0.4);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
      }

      /* Progress indicator */
      .progress-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .progress-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
      }

      .progress-dot.active {
        background: rgba(16, 185, 129, 0.8);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
      }

      .progress-dot.completed {
        background: rgba(16, 185, 129, 0.6);
      }

      /* Main Container - Perfect Centering */
      .page-container {
        position: relative;
        z-index: 10;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        /* Account for top and bottom navigation */
        padding-top: clamp(4rem, 8vh, 5rem);
        padding-bottom: clamp(4rem, 8vh, 5rem);
      }

      .pages-wrapper {
        display: flex;
        height: 100%;
        width: 300vw; /* 3 pages */
        transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }

      /* Individual Pages */
      .page {
        width: 100vw;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        flex-shrink: 0;
        padding: 0 clamp(1rem, 3vw, 2rem);
        overflow: hidden;
      }

      .page-content {
        width: 100%;
        max-width: 1200px;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation: pageAppear 1.2s ease-out;
        gap: clamp(1rem, 2vh, 1.5rem);
      }

      @keyframes pageAppear {
        0% {
          opacity: 0;
          transform: scale(0.95) translateY(30px);
          filter: blur(2px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
          filter: blur(0);
        }
      }

      /* Page Headers */
      .page-header {
        text-align: center;
        flex-shrink: 0;
      }

      .page-icon {
        font-size: clamp(2rem, 4vw, 2.5rem);
        margin-bottom: clamp(0.5rem, 1vh, 0.8rem);
        display: block;
        animation: iconPulse 4s ease-in-out infinite;
      }

      @keyframes iconPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.9;
        }
        50% {
          transform: scale(1.05);
          opacity: 1;
        }
      }

      .page-title {
        font-size: clamp(1.8rem, 3.5vw, 2.5rem);
        font-weight: 300;
        margin-bottom: clamp(0.5rem, 1vh, 0.8rem);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95) 0%,
          rgba(251, 191, 36, 0.8) 50%,
          rgba(255, 255, 255, 0.9) 100%
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        letter-spacing: 0.5px;
        line-height: 1.1;
      }

      .page-subtitle {
        font-size: clamp(0.9rem, 1.8vw, 1.1rem);
        opacity: 0.85;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.4;
        font-weight: 300;
        max-width: 600px;
      }

      /* Page 1: What They'll Receive - Compact Grid */
      .benefits-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: clamp(1rem, 2vw, 1.5rem);
        width: 100%;
        max-width: 1000px;
        flex: 1;
        max-height: 60vh;
      }

      .benefit-card {
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(40px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(12px, 2vw, 18px);
        padding: clamp(1rem, 2vh, 1.5rem);
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .benefit-card::before {
        content: "";
        position: absolute;
        inset: 1px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.06) 0%,
          rgba(251, 191, 36, 0.03) 50%,
          rgba(255, 255, 255, 0.02) 100%
        );
        border-radius: clamp(11px, 2vw, 17px);
        pointer-events: none;
      }

      .benefit-card:hover {
        transform: translateY(-3px);
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      }

      .benefit-icon {
        font-size: clamp(1.5rem, 3vw, 2rem);
        margin-bottom: clamp(0.5rem, 1vh, 0.8rem);
        display: block;
      }

      .benefit-title {
        font-size: clamp(0.9rem, 1.8vw, 1.1rem);
        font-weight: 500;
        margin-bottom: clamp(0.4rem, 0.8vh, 0.6rem);
        color: rgba(255, 255, 255, 0.95);
      }

      .benefit-description {
        font-size: clamp(0.75rem, 1.5vw, 0.85rem);
        color: rgba(255, 255, 255, 0.75);
        line-height: 1.4;
        margin-bottom: clamp(0.6rem, 1.2vh, 0.8rem);
      }

      .benefit-features {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .benefit-features li {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.3rem;
        font-size: clamp(0.7rem, 1.4vw, 0.8rem);
        color: rgba(255, 255, 255, 0.8);
      }

      .feature-icon {
        font-size: 0.85em;
        flex-shrink: 0;
      }

      /* Page 2: Form - Horizontal Layout */
      .form-container {
        width: 100%;
        max-width: 1000px;
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(40px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(16px, 3vw, 24px);
        padding: clamp(1.5rem, 3vh, 2rem);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3),
          0 0 0 1px rgba(255, 255, 255, 0.06);
        position: relative;
        overflow: hidden;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        height: fit-content;
        max-height: 70vh;
      }

      .form-container::before {
        content: "";
        position: absolute;
        inset: 1px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08) 0%,
          rgba(251, 191, 36, 0.03) 30%,
          rgba(147, 51, 234, 0.02) 70%,
          rgba(255, 255, 255, 0.04) 100%
        );
        border-radius: clamp(15px, 3vw, 23px);
        pointer-events: none;
      }

      .gift-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: clamp(1.5rem, 3vw, 2rem);
        align-items: start;
      }

      .form-section {
        display: flex;
        flex-direction: column;
        gap: clamp(1rem, 2vh, 1.3rem);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: clamp(0.8rem, 1.5vw, 1rem);
      }

      .form-group {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: clamp(0.3rem, 0.6vh, 0.4rem);
      }

      .form-group.full-width {
        grid-column: 1 / -1;
      }

      .form-label {
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
        color: rgba(255, 255, 255, 0.8);
        font-weight: 400;
        letter-spacing: 0.3px;
      }

      .form-input {
        padding: clamp(0.8rem, 1.5vh, 1rem);
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(8px, 1.5vw, 12px);
        color: #fff;
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
        font-family: inherit;
        transition: all 0.3s ease;
        font-weight: 300;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      .form-input:focus {
        border-color: rgba(16, 185, 129, 0.4);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.15);
        transform: translateY(-1px);
      }

      .form-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        font-style: italic;
        font-weight: 300;
      }

      .form-textarea {
        min-height: clamp(60px, 10vh, 80px);
        resize: none;
        line-height: 1.5;
        font-family: inherit;
      }

      .char-counter {
        text-align: right;
        font-size: clamp(0.7rem, 1.4vw, 0.8rem);
        color: rgba(255, 255, 255, 0.5);
        margin-top: 0.2rem;
        transition: color 0.3s ease;
      }

      /* Selection sections */
      .selection-section {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: clamp(12px, 2vw, 16px);
        padding: clamp(1.2rem, 2vh, 1.5rem);
        position: relative;
        overflow: hidden;
      }

      .selection-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 100%
        );
      }

      .section-title {
        font-size: clamp(0.9rem, 1.8vw, 1rem);
        font-weight: 500;
        margin-bottom: clamp(0.8rem, 1.5vh, 1rem);
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        letter-spacing: 0.3px;
      }

      .section-title::before {
        content: "‚ú®";
        font-size: 0.9em;
        opacity: 0.8;
      }

      /* Tier and duration selection - Compact */
      .tier-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: clamp(0.8rem, 1.5vw, 1rem);
        margin-bottom: clamp(1rem, 2vh, 1.3rem);
      }

      .duration-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(0.6rem, 1.2vw, 0.8rem);
      }

      .option-card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: clamp(8px, 1.5vw, 12px);
        padding: clamp(0.8rem, 1.5vh, 1rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .option-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.1) 0%,
          rgba(59, 130, 246, 0.08) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .option-card:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }

      .option-card:hover::before {
        opacity: 0.3;
      }

      .option-card.selected {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.3);
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        transform: translateY(-1px);
      }

      .option-card.selected::before {
        opacity: 1;
      }

      .premium-badge {
        position: absolute;
        top: -6px;
        right: -6px;
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        padding: clamp(0.3rem, 0.6vh, 0.4rem) clamp(0.6rem, 1.2vw, 0.8rem);
        border-radius: 6px;
        font-size: clamp(0.6rem, 1.2vw, 0.7rem);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 3px 12px rgba(245, 158, 11, 0.4);
      }

      .option-name {
        font-size: clamp(0.85rem, 1.7vw, 1rem);
        font-weight: 500;
        margin-bottom: clamp(0.4rem, 0.8vh, 0.6rem);
        color: rgba(255, 255, 255, 0.95);
      }

      .option-description {
        font-size: clamp(0.7rem, 1.4vw, 0.8rem);
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.3;
      }

      .option-price {
        font-size: clamp(0.9rem, 1.8vw, 1.1rem);
        font-weight: 600;
        color: #10b981;
      }

      /* Page 3: Payment - Centered Layout */
      .payment-container {
        width: 100%;
        max-width: 600px;
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(40px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(16px, 3vw, 24px);
        padding: clamp(1.5rem, 3vh, 2rem);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        text-align: center;
        position: relative;
        overflow: hidden;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: clamp(1rem, 2vh, 1.5rem);
      }

      .payment-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(16, 185, 129, 0.6) 50%,
          transparent 100%
        );
      }

      .payment-summary {
        display: flex;
        flex-direction: column;
        gap: clamp(0.5rem, 1vh, 0.8rem);
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: clamp(0.6rem, 1.2vh, 0.8rem) 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: clamp(0.85rem, 1.7vw, 0.95rem);
        color: rgba(255, 255, 255, 0.8);
      }

      .summary-item:last-child {
        border-bottom: none;
        font-size: clamp(1rem, 2vw, 1.2rem);
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-top: clamp(0.4rem, 0.8vh, 0.6rem);
      }

      .total-amount {
        font-size: clamp(1.6rem, 3.2vw, 2.2rem);
        font-weight: 600;
        margin-bottom: clamp(0.3rem, 0.6vh, 0.5rem);
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .total-description {
        font-size: clamp(0.85rem, 1.7vw, 0.95rem);
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: clamp(1rem, 2vh, 1.3rem);
      }

      #paypal-button-container {
        min-height: clamp(45px, 8vh, 55px);
        border-radius: clamp(8px, 1.5vw, 12px);
        overflow: hidden;
        opacity: 1;
        transition: opacity 0.3s ease;
      }

      .paypal-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: clamp(0.8rem, 1.5vw, 1rem);
        padding: clamp(1rem, 2vh, 1.3rem);
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: clamp(8px, 1.5vw, 12px);
        color: #93c5fd;
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
      }

      .loading-spinner {
        width: clamp(16px, 3vw, 20px);
        height: clamp(16px, 3vw, 20px);
        border: 2px solid rgba(147, 197, 253, 0.3);
        border-radius: 50%;
        border-top-color: #93c5fd;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Messages */
      .message {
        padding: clamp(0.7rem, 1.4vh, 0.9rem);
        border-radius: clamp(8px, 1.5vw, 12px);
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
        text-align: center;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        font-weight: 300;
        position: fixed;
        top: clamp(1rem, 2vh, 1.5rem);
        right: clamp(1rem, 2vw, 1.5rem);
        max-width: 300px;
        z-index: 200;
      }

      .message.show {
        opacity: 1;
        transform: translateY(0);
      }

      .message.error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        color: rgba(252, 165, 165, 0.9);
      }

      .message.success {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.2);
        color: rgba(110, 231, 183, 0.9);
      }

      .message.info {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        color: rgba(147, 197, 253, 0.9);
      }

      /* Mobile responsive */
      @media (max-width: 1024px) {
        .benefits-grid {
          grid-template-columns: repeat(2, 1fr);
          grid-template-rows: repeat(3, 1fr);
        }

        .gift-form {
          grid-template-columns: 1fr;
          gap: clamp(1.2rem, 2.5vw, 1.5rem);
        }
      }

      @media (max-width: 768px) {
        .page-container {
          padding-top: clamp(3.5rem, 7vh, 4.5rem);
          padding-bottom: clamp(3.5rem, 7vh, 4.5rem);
        }

        .benefits-grid {
          grid-template-columns: 1fr;
          grid-template-rows: repeat(6, 1fr);
          max-height: 70vh;
          overflow-y: auto;
        }

        .benefits-grid::-webkit-scrollbar {
          width: 3px;
        }

        .benefits-grid::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.05);
        }

        .benefits-grid::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 2px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .tier-grid {
          grid-template-columns: 1fr;
        }

        .duration-grid {
          grid-template-columns: 1fr;
        }

        .nav-button {
          font-size: 0.8rem;
          padding: 0.7rem 1.2rem;
        }
      }

      @media (max-width: 480px) {
        .page {
          padding: 0 clamp(0.5rem, 1vw, 1rem);
        }

        .page-navigation {
          bottom: 1rem;
          gap: 0.8rem;
        }

        .nav-button {
          font-size: 0.75rem;
          padding: 0.6rem 1rem;
        }

        .progress-indicator {
          order: -1;
        }

        .benefit-card {
          padding: clamp(0.8rem, 1.5vh, 1rem);
        }

        .form-container {
          padding: clamp(1.2rem, 2.5vh, 1.5rem);
        }
      }

      /* Ultra-wide screens */
      @media (min-width: 1600px) {
        .benefits-grid {
          max-width: 1400px;
          gap: 2rem;
        }

        .form-container {
          max-width: 1200px;
        }
      }

      /* Very short screens */
      @media (max-height: 600px) {
        .page-container {
          padding-top: clamp(3rem, 6vh, 4rem);
          padding-bottom: clamp(3rem, 6vh, 4rem);
        }

        .page-title {
          font-size: clamp(1.4rem, 2.8vw, 1.8rem);
          margin-bottom: 0.3rem;
        }

        .page-subtitle {
          font-size: clamp(0.8rem, 1.6vw, 0.9rem);
        }

        .benefit-card {
          padding: 0.8rem;
        }

        .form-container {
          padding: 1.2rem;
        }
      }

      /* Landscape mobile */
      @media (max-height: 500px) and (orientation: landscape) {
        .page-container {
          padding-top: 2.5rem;
          padding-bottom: 2.5rem;
        }

        .page-navigation {
          bottom: 0.8rem;
        }

        .back-link {
          top: 0.8rem;
        }

        .benefits-grid {
          grid-template-columns: repeat(3, 1fr);
          grid-template-rows: repeat(2, 1fr);
          max-height: 50vh;
        }
      }

      /* Accessibility */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Focus styles */
      .nav-button:focus-visible,
      .option-card:focus-visible,
      .form-input:focus-visible,
      .back-link:focus-visible {
        outline: 2px solid rgba(16, 185, 129, 0.6);
        outline-offset: 2px;
      }

      /* Remove default outlines */
      * {
        outline: none !important;
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  </head>

  <body>
    <!-- Floating particles -->
    <div class="floating-particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>

    <!-- Top Navigation -->
    <a href="/" class="back-link">
      <span>‚Üê</span>
      <span>Return to Portal</span>
    </a>

    <!-- Messages -->
    <div class="message error" id="errorMessage" style="display: none"></div>
    <div
      class="message success"
      id="successMessage"
      style="display: none"
    ></div>
    <div class="message info" id="infoMessage" style="display: none"></div>

    <!-- Main Container -->
    <div class="page-container">
      <div class="pages-wrapper" id="pagesWrapper">
        <!-- Page 1: What They'll Receive -->
        <div class="page" id="page1">
          <div class="page-content">
            <div class="page-header">
              <div class="page-icon">üéÅ</div>
              <h1 class="page-title">What They'll Receive</h1>
              <p class="page-subtitle">
                A complete self-discovery experience that transforms how they
                see themselves
              </p>
            </div>

            <div class="benefits-grid">
              <div class="benefit-card">
                <div class="benefit-icon">üìß</div>
                <div class="benefit-title">Beautiful Welcome Invitation</div>
                <div class="benefit-description">
                  A personalized email invitation that feels special and sacred
                </div>
                <ul class="benefit-features">
                  <li>
                    <span class="feature-icon">‚ú®</span> Personal message from
                    you
                  </li>
                  <li>
                    <span class="feature-icon">üé®</span> Beautifully designed
                    experience
                  </li>
                  <li>
                    <span class="feature-icon">üîó</span> Direct access link
                    included
                  </li>
                </ul>
              </div>

              <div class="benefit-card">
                <div class="benefit-icon">ü™û</div>
                <div class="benefit-title">AI-Powered Reflection</div>
                <div class="benefit-description">
                  Advanced AI that recognizes patterns they can't see about
                  themselves
                </div>
                <ul class="benefit-features">
                  <li>
                    <span class="feature-icon">üß†</span> Deep pattern
                    recognition
                  </li>
                  <li>
                    <span class="feature-icon">üíé</span> Personalized insights
                  </li>
                  <li>
                    <span class="feature-icon">üå±</span> Growth-focused feedback
                  </li>
                </ul>
              </div>

              <div class="benefit-card">
                <div class="benefit-icon">üìä</div>
                <div class="benefit-title">Personal Dashboard</div>
                <div class="benefit-description">
                  A sacred space to track their journey and evolution over time
                </div>
                <ul class="benefit-features">
                  <li>
                    <span class="feature-icon">üìö</span> All reflections saved
                  </li>
                  <li>
                    <span class="feature-icon">üîç</span> Search and organize
                  </li>
                  <li>
                    <span class="feature-icon">üìà</span> Track personal growth
                  </li>
                </ul>
              </div>

              <div class="benefit-card">
                <div class="benefit-icon">ü¶ã</div>
                <div class="benefit-title">Evolution Reports</div>
                <div class="benefit-description">
                  See how their patterns evolve and transform over months
                </div>
                <ul class="benefit-features">
                  <li><span class="feature-icon">üìä</span> Growth analytics</li>
                  <li>
                    <span class="feature-icon">üéØ</span> Pattern evolution
                  </li>
                  <li>
                    <span class="feature-icon">‚ö°</span> Breakthrough insights
                  </li>
                </ul>
              </div>

              <div class="benefit-card">
                <div class="benefit-icon">üîí</div>
                <div class="benefit-title">Complete Privacy</div>
                <div class="benefit-description">
                  Their reflections remain completely private and secure
                </div>
                <ul class="benefit-features">
                  <li>
                    <span class="feature-icon">üõ°Ô∏è</span> End-to-end security
                  </li>
                  <li>
                    <span class="feature-icon">ü§ê</span> Never shared or sold
                  </li>
                  <li>
                    <span class="feature-icon">üíæ</span> Permanently saved
                  </li>
                </ul>
              </div>

              <div class="benefit-card">
                <div class="benefit-icon">‚è∞</div>
                <div class="benefit-title">Immediate Access</div>
                <div class="benefit-description">
                  They can start their first reflection within minutes
                </div>
                <ul class="benefit-features">
                  <li>
                    <span class="feature-icon">üö™</span> Instant activation
                  </li>
                  <li>
                    <span class="feature-icon">üì±</span> Works on any device
                  </li>
                  <li>
                    <span class="feature-icon">üåç</span> Available anywhere
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Page 2: Fill Details -->
        <div class="page" id="page2">
          <div class="page-content">
            <div class="page-header">
              <div class="page-icon">‚úçÔ∏è</div>
              <h1 class="page-title">Gift Details</h1>
              <p class="page-subtitle">
                Tell us about this thoughtful gift and choose the perfect access
                level
              </p>
            </div>

            <div class="form-container">
              <form id="giftForm" class="gift-form">
                <!-- Left Column: Personal Details -->
                <div class="form-section">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">Your name</label>
                      <input
                        type="text"
                        id="giverName"
                        class="form-input"
                        placeholder="Your full name"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Your email</label>
                      <input
                        type="email"
                        id="giverEmail"
                        class="form-input"
                        placeholder="your@email.com"
                        required
                      />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">Recipient's name</label>
                      <input
                        type="text"
                        id="recipientName"
                        class="form-input"
                        placeholder="Who will receive this gift?"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Recipient's email</label>
                      <input
                        type="email"
                        id="recipientEmail"
                        class="form-input"
                        placeholder="their@email.com"
                        required
                      />
                    </div>
                  </div>

                  <div class="form-group full-width">
                    <label class="form-label"
                      >Personal message (optional)</label
                    >
                    <textarea
                      id="personalMessage"
                      class="form-input form-textarea"
                      placeholder="Why are you sharing this journey of self-discovery with them?"
                      maxlength="200"
                    ></textarea>
                    <div class="char-counter">
                      <span id="charCount">0</span>/200 characters
                    </div>
                  </div>
                </div>

                <!-- Right Column: Selections -->
                <div class="form-section">
                  <div class="selection-section">
                    <h3 class="section-title">Choose access level</h3>
                    <div class="tier-grid">
                      <div class="option-card" data-tier="essential">
                        <div class="option-name">Essential</div>
                        <div class="option-description">
                          5 reflections/month<br />
                          Pattern insights<br />
                          Growth tracking
                        </div>
                      </div>
                      <div class="option-card" data-tier="premium">
                        <div class="premium-badge">Most Popular</div>
                        <div class="option-name">Premium</div>
                        <div class="option-description">
                          10 reflections/month<br />
                          Advanced AI analysis<br />
                          Deep insights
                        </div>
                      </div>
                    </div>

                    <h3 class="section-title">Choose duration</h3>
                    <div class="duration-grid">
                      <div class="option-card" data-duration="1mo">
                        <div class="option-name">1 Month</div>
                        <div class="option-price" id="price1mo">$4.99</div>
                      </div>
                      <div class="option-card" data-duration="3mo">
                        <div class="option-name">3 Months</div>
                        <div class="option-price" id="price3mo">$14.97</div>
                      </div>
                      <div class="option-card" data-duration="1yr">
                        <div class="option-name">1 Year</div>
                        <div class="option-price" id="price1yr">$49.99</div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Page 3: Payment -->
        <div class="page" id="page3">
          <div class="page-content">
            <div class="page-header">
              <div class="page-icon">üí≥</div>
              <h1 class="page-title">Complete Your Gift</h1>
              <p class="page-subtitle">
                Secure payment to activate their transformational journey
              </p>
            </div>

            <div class="payment-container">
              <div class="payment-summary">
                <div class="summary-item">
                  <span>Recipient:</span>
                  <span id="summaryRecipient">Name</span>
                </div>
                <div class="summary-item">
                  <span>Access Level:</span>
                  <span id="summaryTier">Essential</span>
                </div>
                <div class="summary-item">
                  <span>Duration:</span>
                  <span id="summaryDuration">1 Month</span>
                </div>
                <div class="summary-item">
                  <span>Total:</span>
                  <span id="summaryTotal">$4.99</span>
                </div>
              </div>

              <div class="total-amount" id="totalAmount">$4.99</div>
              <div class="total-description" id="totalDescription">
                Essential ‚Ä¢ 1 Month Gift
              </div>

              <div class="paypal-loading" id="paypalLoading">
                <div class="loading-spinner"></div>
                <span>Loading secure payment...</span>
              </div>

              <div id="paypal-button-container"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="page-navigation">
      <button
        class="nav-button"
        id="prevBtn"
        onclick="goToPreviousPage()"
        disabled
      >
        <span>‚Üê</span>
        <span>Previous</span>
      </button>

      <div class="progress-indicator">
        <div class="progress-dot active" data-page="0"></div>
        <div class="progress-dot" data-page="1"></div>
        <div class="progress-dot" data-page="2"></div>
      </div>

      <button class="nav-button primary" id="nextBtn" onclick="goToNextPage()">
        <span>Next</span>
        <span>‚Üí</span>
      </button>
    </div>

    <script>
      // Perfect No-Scroll 3-Page Gifting Experience
      let currentPage = 0;
      let selectedTier = "essential";
      let selectedDuration = "1mo";
      let currentAmount = "4.99";
      let giftPricing = {};
      let paypalConfig = null;
      let paypalInitialized = false;
      let isProcessing = false;

      // Initialize the experience
      document.addEventListener("DOMContentLoaded", function () {
        initializeGiftingExperience();
      });

      async function initializeGiftingExperience() {
        setupEventListeners();
        await loadGiftPricing();
        await loadPayPalConfiguration();
        initializeSelections();
        updatePageDisplay();
        console.log(
          "üéÅ Perfect No-Scroll 3-Page Gifting Experience initialized"
        );
      }

      function setupEventListeners() {
        // Form validation
        ["giverName", "giverEmail", "recipientName", "recipientEmail"].forEach(
          (id) => {
            document.getElementById(id).addEventListener("input", validateForm);
            document.getElementById(id).addEventListener("blur", validateField);
          }
        );

        // Personal message counter
        const messageInput = document.getElementById("personalMessage");
        const charCount = document.getElementById("charCount");

        messageInput.addEventListener("input", function () {
          const length = this.value.length;
          charCount.textContent = length;

          const counter = document.querySelector(".char-counter");
          if (length > 160) {
            counter.style.color = "#ef4444";
          } else if (length > 120) {
            counter.style.color = "#f59e0b";
          } else {
            counter.style.color = "rgba(255, 255, 255, 0.5)";
          }
        });

        // Name formatting
        ["giverName", "recipientName"].forEach((id) => {
          document.getElementById(id).addEventListener("blur", function () {
            this.value = this.value.replace(/\b\w/g, (l) => l.toUpperCase());
          });
        });

        // Tier selection
        document.querySelectorAll("[data-tier]").forEach((option) => {
          option.addEventListener("click", function () {
            selectTier(this.dataset.tier);
          });
        });

        // Duration selection
        document.querySelectorAll("[data-duration]").forEach((option) => {
          option.addEventListener("click", function () {
            selectDuration(this.dataset.duration);
          });
        });

        // Keyboard navigation
        document.addEventListener("keydown", handleKeyboardNavigation);
      }

      function handleKeyboardNavigation(e) {
        if (
          e.key === "ArrowRight" ||
          (e.key === "Enter" &&
            e.target.tagName !== "INPUT" &&
            e.target.tagName !== "TEXTAREA")
        ) {
          if (currentPage < 2) {
            goToNextPage();
          }
        } else if (e.key === "ArrowLeft") {
          if (currentPage > 0) {
            goToPreviousPage();
          }
        }
      }

      async function loadGiftPricing() {
        try {
          const response = await fetch("/api/subscriptions?action=get-pricing");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          const result = await response.json();
          if (!result.success)
            throw new Error(result.error || "Failed to load pricing");

          giftPricing = result.pricing.gifts;
          updatePricingDisplay();
        } catch (error) {
          console.error("Pricing error:", error);
          // Fallback pricing
          giftPricing = {
            essential: { "1mo": 4.99, "3mo": 14.97, "1yr": 49.99 },
            premium: { "1mo": 9.99, "3mo": 29.97, "1yr": 99.99 },
          };
          updatePricingDisplay();
        }
      }

      function updatePricingDisplay() {
        document.getElementById(
          "price1mo"
        ).textContent = `$${giftPricing[selectedTier]["1mo"]}`;
        document.getElementById(
          "price3mo"
        ).textContent = `$${giftPricing[selectedTier]["3mo"]}`;
        document.getElementById(
          "price1yr"
        ).textContent = `$${giftPricing[selectedTier]["1yr"]}`;

        currentAmount = giftPricing[selectedTier][selectedDuration].toString();
        updatePaymentSummary();
      }

      function initializeSelections() {
        selectTier("essential");
        selectDuration("1mo");
      }

      function selectTier(tier) {
        selectedTier = tier;

        // Update tier selection UI
        document.querySelectorAll("[data-tier]").forEach((option) => {
          option.classList.remove("selected");
        });
        document
          .querySelector(`[data-tier="${tier}"]`)
          .classList.add("selected");

        updatePricingDisplay();
        createSelectionEffect(document.querySelector(`[data-tier="${tier}"]`));
      }

      function selectDuration(duration) {
        selectedDuration = duration;

        // Update duration selection UI
        document.querySelectorAll("[data-duration]").forEach((option) => {
          option.classList.remove("selected");
        });
        document
          .querySelector(`[data-duration="${duration}"]`)
          .classList.add("selected");

        currentAmount = giftPricing[selectedTier][duration].toString();
        updatePaymentSummary();
        createSelectionEffect(
          document.querySelector(`[data-duration="${duration}"]`)
        );
      }

      function updatePaymentSummary() {
        const tierName =
          selectedTier.charAt(0).toUpperCase() + selectedTier.slice(1);
        const durationText =
          selectedDuration === "1mo"
            ? "1 Month"
            : selectedDuration === "3mo"
            ? "3 Months"
            : "1 Year";

        document.getElementById("summaryTier").textContent = tierName;
        document.getElementById("summaryDuration").textContent = durationText;
        document.getElementById(
          "summaryTotal"
        ).textContent = `$${currentAmount}`;
        document.getElementById(
          "totalAmount"
        ).textContent = `$${currentAmount}`;
        document.getElementById(
          "totalDescription"
        ).textContent = `${tierName} ‚Ä¢ ${durationText} Gift`;

        // Update recipient name if available
        const recipientName = document
          .getElementById("recipientName")
          .value.trim();
        if (recipientName) {
          document.getElementById("summaryRecipient").textContent =
            recipientName;
        }
      }

      async function loadPayPalConfiguration() {
        try {
          const response = await fetch("/api/payment?action=config");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          const result = await response.json();
          if (!result.success)
            throw new Error(result.error || "PayPal configuration failed");

          paypalConfig = result.config;
        } catch (error) {
          console.error("PayPal configuration error:", error);
          showMessage(
            "Payment system initialization failed. Please refresh the page.",
            "error"
          );
        }
      }

      function goToNextPage() {
        if (currentPage === 1) {
          // Validate form before going to payment
          if (!validateForm()) {
            showMessage(
              "Please fill in all required fields with valid information.",
              "error"
            );
            return;
          }
          updatePaymentSummary();
          if (!paypalInitialized) {
            initializePayPal();
          }
        }

        if (currentPage < 2) {
          currentPage++;
          updatePageDisplay();
        }
      }

      function goToPreviousPage() {
        if (currentPage > 0) {
          currentPage--;
          updatePageDisplay();
        }
      }

      function updatePageDisplay() {
        const pagesWrapper = document.getElementById("pagesWrapper");
        pagesWrapper.style.transform = `translateX(-${currentPage * 100}vw)`;

        // Update navigation buttons
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        prevBtn.disabled = currentPage === 0;

        if (currentPage === 2) {
          nextBtn.style.display = "none";
        } else {
          nextBtn.style.display = "flex";
        }

        // Update progress indicator
        document.querySelectorAll(".progress-dot").forEach((dot, index) => {
          dot.classList.remove("active", "completed");
          if (index === currentPage) {
            dot.classList.add("active");
          } else if (index < currentPage) {
            dot.classList.add("completed");
          }
        });
      }

      function validateForm() {
        const giverName = document.getElementById("giverName").value.trim();
        const giverEmail = document.getElementById("giverEmail").value.trim();
        const recipientName = document
          .getElementById("recipientName")
          .value.trim();
        const recipientEmail = document
          .getElementById("recipientEmail")
          .value.trim();

        return (
          giverName &&
          validateEmail(giverEmail) &&
          recipientName &&
          validateEmail(recipientEmail)
        );
      }

      function validateField(event) {
        const field = event.target;
        const value = field.value.trim();

        if (field.type === "email") {
          if (value && !validateEmail(value)) {
            field.style.borderColor = "rgba(239, 68, 68, 0.4)";
          } else {
            field.style.borderColor = "";
          }
        } else if (field.type === "text") {
          if (value && value.length < 2) {
            field.style.borderColor = "rgba(245, 158, 11, 0.4)";
          } else {
            field.style.borderColor = "";
          }
        }
      }

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function initializePayPal() {
        if (!window.paypal || !window.paypal.Buttons) {
          loadPayPalSDK()
            .then(() => {
              renderPayPalButtons();
            })
            .catch((error) => {
              console.error("PayPal loading error:", error);
              showMessage(
                "Payment system error. Please refresh the page.",
                "error"
              );
            });
        } else {
          renderPayPalButtons();
        }
      }

      function loadPayPalSDK() {
        return new Promise((resolve, reject) => {
          if (window.paypal && window.paypal.Buttons) {
            resolve();
            return;
          }

          const script = document.createElement("script");
          script.src = `https://www.paypal.com/sdk/js?client-id=${paypalConfig.clientId}&currency=${paypalConfig.currency}&intent=capture`;

          script.onload = () => {
            setTimeout(() => {
              if (window.paypal && window.paypal.Buttons) {
                resolve();
              } else {
                reject(new Error("PayPal loaded but not available"));
              }
            }, 100);
          };

          script.onerror = () => {
            reject(new Error("Failed to load PayPal"));
          };

          document.head.appendChild(script);
        });
      }

      function renderPayPalButtons() {
        document.getElementById("paypalLoading").style.display = "none";

        try {
          window.paypal
            .Buttons({
              style: {
                color: "gold",
                shape: "rect",
                label: "pay",
                height: 45,
                tagline: false,
              },

              createOrder: function (data, actions) {
                const giverName = document
                  .getElementById("giverName")
                  .value.trim();
                const giverEmail = document
                  .getElementById("giverEmail")
                  .value.trim();
                const tierName =
                  selectedTier.charAt(0).toUpperCase() + selectedTier.slice(1);
                const durationText =
                  selectedDuration === "1mo"
                    ? "1 Month"
                    : selectedDuration === "3mo"
                    ? "3 Months"
                    : "1 Year";

                const orderData = {
                  purchase_units: [
                    {
                      amount: {
                        value: currentAmount,
                        currency_code: paypalConfig.currency,
                      },
                      description: `Mirror of Truth - ${tierName} Gift (${durationText})`,
                    },
                  ],
                };

                if (giverEmail && validateEmail(giverEmail)) {
                  orderData.payer = {
                    email_address: giverEmail,
                    name: {
                      given_name: giverName.split(" ")[0] || giverName,
                      surname: giverName.split(" ").slice(1).join(" ") || "",
                    },
                  };
                }

                return actions.order.create(orderData);
              },

              onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                  handleGiftCompletion(details);
                });
              },

              onError: function (err) {
                console.error("PayPal error:", err);
                showMessage("Payment error. Please try again.", "error");
              },
            })
            .render("#paypal-button-container")
            .then(() => {
              paypalInitialized = true;
            });
        } catch (error) {
          console.error("PayPal render error:", error);
          showMessage(
            "Payment system error. Please refresh the page.",
            "error"
          );
        }
      }

      async function handleGiftCompletion(paymentDetails) {
        try {
          const giftData = {
            giverName: document.getElementById("giverName").value.trim(),
            giverEmail: document.getElementById("giverEmail").value.trim(),
            recipientName: document
              .getElementById("recipientName")
              .value.trim(),
            recipientEmail: document
              .getElementById("recipientEmail")
              .value.trim(),
            personalMessage: document
              .getElementById("personalMessage")
              .value.trim(),
            subscriptionTier: selectedTier,
            subscriptionDuration: selectedDuration,
            amount: parseFloat(currentAmount),
            paymentMethod: "paypal",
            paymentId: paymentDetails.id,
          };

          const response = await fetch("/api/subscriptions", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: "gift-subscription",
              ...giftData,
            }),
          });

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || "Failed to create gift");
          }

          const tierName =
            selectedTier.charAt(0).toUpperCase() + selectedTier.slice(1);
          const durationText =
            selectedDuration === "1mo"
              ? "one month"
              : selectedDuration === "3mo"
              ? "three months"
              : "one year";

          showMessage(
            `üéÅ Gift successfully created! ${giftData.recipientName} will receive ${durationText} of ${tierName} access.`,
            "success"
          );

          setTimeout(() => {
            window.location.href = "/";
          }, 3000);
        } catch (error) {
          console.error("Gift creation error:", error);
          showMessage(
            "Gift was paid for but invitation creation failed. Please contact support.",
            "error"
          );
        }
      }

      function showMessage(message, type) {
        const messageDiv = document.getElementById(`${type}Message`);
        if (!messageDiv) return;

        // Hide all messages first
        hideMessages();

        messageDiv.textContent = message;
        messageDiv.style.display = "block";

        requestAnimationFrame(() => {
          messageDiv.classList.add("show");
        });

        if (type === "error") {
          setTimeout(hideMessages, 6000);
        } else if (type === "success") {
          setTimeout(hideMessages, 8000);
        }
      }

      function hideMessages() {
        ["errorMessage", "successMessage", "infoMessage"].forEach((id) => {
          const div = document.getElementById(id);
          if (div) {
            div.classList.remove("show");
            setTimeout(() => (div.style.display = "none"), 300);
          }
        });
      }

      function createSelectionEffect(element) {
        const rect = element.getBoundingClientRect();
        for (let i = 0; i < 4; i++) {
          setTimeout(() => {
            const effect = document.createElement("div");
            const offsetX = (Math.random() - 0.5) * 80;
            const offsetY = (Math.random() - 0.5) * 80;

            effect.style.cssText = `
              position: fixed;
              left: ${rect.left + rect.width / 2 + offsetX}px;
              top: ${rect.top + rect.height / 2 + offsetY}px;
              width: 4px;
              height: 4px;
              background: radial-gradient(circle, rgba(16, 185, 129, 1) 0%, rgba(251, 191, 36, 0.8) 60%, transparent 90%);
              border-radius: 50%;
              pointer-events: none;
              z-index: 1000;
              animation: selectionEffect 2.5s ease-out forwards;
            `;

            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 2500);
          }, i * 60);
        }
      }

      // Add selection effect animation
      const effectStyle = document.createElement("style");
      effectStyle.textContent = `
        @keyframes selectionEffect {
          0% { opacity: 0; transform: scale(0) rotate(0deg); }
          50% { opacity: 1; transform: scale(1.5) rotate(180deg); }
          100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
      `;
      document.head.appendChild(effectStyle);

      // Debug (development only)
      if (window.location.hostname === "localhost") {
        window.giftingDebug = {
          currentPage: () => currentPage,
          goToPage: (page) => {
            currentPage = Math.max(0, Math.min(2, page));
            updatePageDisplay();
          },
          selectedTier: () => selectedTier,
          selectedDuration: () => selectedDuration,
          validateForm: validateForm,
        };
      }
    </script>
  </body>
</html>
